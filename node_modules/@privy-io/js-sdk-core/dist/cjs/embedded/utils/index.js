"use strict";var r=require("@ethersproject/abstract-signer"),e=require("@ethersproject/providers"),t=require("../errors.js"),i=require("../gas/arbitrum.js"),s=require("../gas/bsc.js"),a=require("../gas/op-stack.js"),o=require("../gas/polygon.js"),p=require("./gas.js");require("../types.js"),require("@ethersproject/bignumber"),require("../../chains/arbitrum.js"),require("../../chains/arbitrumGoerli.js"),require("../../chains/arbitrumSepolia.js"),require("./ethers.js"),require("@ethersproject/contracts"),require("@ethersproject/transactions"),require("../../chains/base.js"),require("../../chains/baseGoerli.js"),require("../../chains/baseSepolia.js"),require("../../chains/optimism.js"),require("../../chains/optimismGoerli.js"),require("../../chains/optimismSepolia.js"),require("../../chains/zora.js"),require("../../chains/zoraSepolia.js"),require("../../chains/zoraTestnet.js"),require("@ethersproject/units"),require("fetch-retry"),require("../../chains/polygon.js"),require("../../chains/polygonAmoy.js"),require("../../chains/polygonMumbai.js");function n(r){return/^-?0x[a-f0-9]+$/i.test(r)}function c(r){for(let e of["gasLimit","gasPrice","value","maxPriorityFeePerGas","maxFeePerGas"]){let t=r[e];if(void 0!==t&&!function(r){let e="number"==typeof r,t="bigint"==typeof r,i="string"==typeof r&&n(r);return e||t||i}(t))throw Error(`Transaction request property '${e}' must be a valid number, bigint, or hex string representing a quantity`)}if("number"!=typeof r.chainId)throw Error("Transaction request property 'chainId' must be a number")}exports.getJsonRpcEndpointFromChain=(r,e,i)=>{let s,a=r.id,o=Number(r.id);if(r.rpcUrls.privyWalletOverride&&r.rpcUrls.privyWalletOverride.http[0])s=r.rpcUrls.privyWalletOverride.http[0];else if(e.rpcUrls&&e.rpcUrls[o])s=e.rpcUrls[o];else if(r.rpcUrls.privy?.http[0]){let e=new URL(r.rpcUrls.privy.http[0]);e.searchParams.append("privyAppId",i),s=e.toString()}else s=r.rpcUrls.public?.http[0]?r.rpcUrls.public.http[0]:r.rpcUrls.default?.http[0];if(!s)throw new t.PrivyConnectorError(`No RPC url found for ${a}`);return s},exports.getJsonRpcProvider=(r,i,s,a)=>{let o=Number(r),p=i.find((r=>r.id===o));if(!p)throw new t.PrivyConnectorError(`Unsupported chainId ${r}`,4901);return new e.StaticJsonRpcProvider(p.rpcUrls.privyWalletOverride&&p.rpcUrls.privyWalletOverride.http[0]?p.rpcUrls.privyWalletOverride.http[0]:s.rpcUrls&&s.rpcUrls[o]?s.rpcUrls[o]:p.rpcUrls.privy?.http[0]?{url:p.rpcUrls.privy.http[0],headers:{"privy-app-id":a.appId}}:p.rpcUrls.public?.http[0]?p.rpcUrls.public?.http[0]:p.rpcUrls.default?.http[0])},exports.populateTransactionRequest=async function(e,t,u){if(t.chainId=Number(t.chainId),c(t),t.from||(t.from=e),!t.nonce){let i=new r.VoidSigner(e,u);t.nonce=await i.getTransactionCount("pending")}return t.gasLimit||(t.gas?(t.gasLimit=t.gas,delete t.gas):t.gasLimit=await p.defaultGasLimit(t,u)),"string"==typeof t.type&&n(t.type)&&(t.type=Number(t.type)),[23294,23295].includes(t.chainId)&&(t.type=0),0===(t=o.isPolygon(t.chainId)?await o.defaultGasForPolygon(t):i.isArbitrum(t.chainId)?await i.defaultGasForArbitrum(t,u):a.isOpStack(t.chainId)?await a.defaultGasForOpStack(t,u):s.isBsc(t.chainId)?await s.defaultGasForBsc(t,u):await p.defaultGasForEvmChain(t,u)).type&&delete t.accessList,2!==t.type&&(delete t.maxPriorityFeePerGas,delete t.maxFeePerGas),t},exports.throwIfInvalidRecoveryUpgradePath=function({currentRecoveryMethod:r,upgradeToRecoveryMethod:e}){switch(r){case"privy":case"user-passcode":return!0;case"icloud":case"google-drive":if(r===e)throw Error("Cannot upgrade to the existing cloud platform");return!0;default:throw Error("Unknown recovery method")}},exports.validateTransactionRequest=c;
