import{createAbstractClient as o}from"@abstract-foundation/agw-client";import{createWalletClient as n,custom as e}from"viem";import{toAccount as t}from"viem/accounts";import{abstractTestnet as s}from"viem/chains";import{getEntropyDetailsFromUser as r}from"../client/user.mjs";import{usePrivyInternal as i}from"../hooks/internal-context.mjs";import{usePrivyModal as a}from"../hooks/modal-context.mjs";import{usePrivyContext as c}from"../hooks/privy-context.mjs";import{useWallets as m}from"../hooks/useWallets.mjs";import{ModalScreen as p}from"../screens/index.mjs";import{getJsonRpcEndpointFromChain as l}from"../utils/index.mjs";import{getEmbeddedConnectedWallet as d}from"./getEmbeddedConnectedWallet.mjs";import{callsToTransactionRequests as h}from"./smart-wallets.mjs";import"@ethersproject/address";import"react";import"../hooks/index.mjs";import"react/jsx-runtime";import"../components/PrefetchedImage.mjs";import"../configuration/context.mjs";import"../config.mjs";import"../configuration/defaultClientConfig.mjs";import"../constants.mjs";import"../configuration/login-methods.mjs";import"../configuration/wallets.mjs";import"../connectors/chains/index.mjs";import"../connectors/chains/arbitrum.mjs";import"../connectors/chains/arbitrumSepolia.mjs";import"../connectors/chains/avalanche.mjs";import"../connectors/chains/avalancheFuji.mjs";import"../connectors/chains/base.mjs";import"../connectors/chains/baseSepolia.mjs";import"../connectors/chains/berachainArtio.mjs";import"../connectors/chains/celo.mjs";import"../connectors/chains/celoAlfajores.mjs";import"../connectors/chains/filecoin.mjs";import"../connectors/chains/filecoinCalibration.mjs";import"../connectors/chains/garnetHolesky.mjs";import"../connectors/chains/holesky.mjs";import"../connectors/chains/linea.mjs";import"../connectors/chains/lineaTestnet.mjs";import"../connectors/chains/lukso.mjs";import"../connectors/chains/mainnet.mjs";import"../connectors/chains/optimism.mjs";import"../connectors/chains/optimismSepolia.mjs";import"../connectors/chains/polygon.mjs";import"../connectors/chains/polygonAmoy.mjs";import"../connectors/chains/redstone.mjs";import"../connectors/chains/sepolia.mjs";import"../connectors/chains/zora.mjs";import"../connectors/chains/zoraSepolia.mjs";import"../connectors/chains/zoraTestnet.mjs";import"../connectors/chains/utils.mjs";import"./solana/index.mjs";import"../theme.mjs";import"tinycolor2";import"./cybr53.mjs";import"@ethersproject/providers";import"../connectors/get-legacy-injected-providers.mjs";import"../connectors/is-wallet-installed.mjs";import"../errors.mjs";import"ofetch";import"../hooks/useSmartWalletChain.mjs";import"./smart-wallets-shared.mjs";import"permissionless";import"permissionless/accounts";import"permissionless/clients/pimlico";import"viem/account-abstraction";import"@privy-io/js-sdk-core";function j(){let{user:j}=c(),{noPromptOnSignature:u,openPrivyModal:g,chains:E,appId:f,rpcConfig:y}=i(),{wallets:T}=m(),{setModalData:I}=a(),C=async()=>{let r=d(T);if(!r)throw Error("No connected wallet found");let i=E.find((o=>o.id===s.id));if(!i)throw Error("Chain not configured");await r.switchChain(i.id);let a=await r.getEthereumProvider(),c=n({account:r.address,transport:e(a)}),m=t({address:r.address,signMessage:c.signMessage,signTransaction:c.signTransaction,signTypedData:c.signTypedData});return await o({chain:{...i,rpcUrls:{default:{http:[l(i,y,f)]}}},signer:m})};return{signMessage:async({message:o})=>{let n=await C();return new Promise((async(e,t)=>{let{entropyId:s,entropyIdVerifier:i}=r(j);u.current=!0,I({connectWallet:{entropyId:s,entropyIdVerifier:i,onCompleteNavigateTo:p.EMBEDDED_WALLET_SIGN_REQUEST_SCREEN,onFailure:()=>{}},signMessage:{method:"personal_sign",data:o,confirmAndSign:()=>n.signMessage({message:o}),onSuccess:o=>e(o),onFailure:t,uiOptions:{}}}),g(p.EMBEDDED_WALLET_CONNECTING_SCREEN)})).finally((()=>{u.current=!1}))},signTypedData:async o=>{let n=await C();return new Promise((async(e,t)=>{u.current=!0;let{entropyId:s,entropyIdVerifier:i}=r(j);I({connectWallet:{entropyId:s,entropyIdVerifier:i,onCompleteNavigateTo:p.EMBEDDED_WALLET_SIGN_REQUEST_SCREEN,onFailure:()=>{}},signMessage:{method:"eth_signTypedData_v4",data:o,confirmAndSign:()=>n.signTypedData(o),onSuccess:o=>e(o),onFailure:t,uiOptions:{}}}),g(p.EMBEDDED_WALLET_CONNECTING_SCREEN)})).finally((()=>{u.current=!1}))},sendTransaction:async o=>{let n=await C(),e=[];return e="calls"in o&&void 0!==o.calls?[...o.calls]:[o],new Promise((async(t,s)=>{u.current=!0;let{entropyId:i,entropyIdVerifier:a}=r(j);I({connectWallet:{entropyId:i,entropyIdVerifier:a,onCompleteNavigateTo:p.EMBEDDED_WALLET_SEND_TRANSACTION_SCREEN,onFailure:()=>{}},sendTransaction:{transactionRequests:h({calls:e,chain:n.chain,maxPriorityFeePerGas:o.maxPriorityFeePerGas,maxFeePerGas:o.maxFeePerGas,nonce:o.nonce?BigInt(o.nonce):void 0}),entropyId:i,entropyIdVerifier:a,transactingWallet:{address:n.account.address,walletIndex:null},getIsSponsored:async()=>void 0!==o.paymaster&&void 0!==o.paymasterInput,onConfirm:()=>e.length>1?n.sendTransactionBatch(o):n.sendTransaction(o),onSuccess:o=>t(o.hash),onFailure:s,uiOptions:{}}}),g(p.EMBEDDED_WALLET_CONNECTING_SCREEN)})).finally((()=>{u.current=!1}))}}}export{j as useAbstractSmartWallets};
