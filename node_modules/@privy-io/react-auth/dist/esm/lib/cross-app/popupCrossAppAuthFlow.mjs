import{USE_BROADCAST_CHANNEL_EVENT_TYPE as e,CROSS_APP_BROADCAST_CHANNEL_NAME as t}from"./index.mjs";import{PrivyClientError as a}from"../../errors.mjs";import"ofetch";async function o({url:o,popup:r}){return r.location=o,new Promise(((o,n)=>{let i,s=setTimeout((()=>{n(new a("Authorization request timed out after 2 minutes.")),d()}),12e4);function d(){r?.close(),window.removeEventListener("message",u)}let m=setInterval((()=>{r?.closed&&!i&&(d(),clearInterval(m),clearTimeout(s),n(new a("User rejected request")))}),300);function u(r){r.data&&("PRIVY_OAUTH_RESPONSE"===r.data.type&&r.data.stateCode&&r.data.authorizationCode&&(clearTimeout(s),o(r.data),d()),"PRIVY_OAUTH_ERROR"===r.data.type&&(clearTimeout(s),n(new a(r.data.error)),d()),r.data.type===e&&((i=new BroadcastChannel(t)).onmessage=u))}window.addEventListener("message",u)}))}export{o as popupCrossAppAuthFlow};
