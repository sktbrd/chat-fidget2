import{jsx as i}from"react/jsx-runtime";import{useContext as o,useState as t,useEffect as n,createContext as e}from"react";import{useAppConfig as r}from"../configuration/context.mjs";import{PrivyClientError as s}from"../errors.mjs";import{getEmbeddedConnectedWallet as c}from"../lib/getEmbeddedConnectedWallet.mjs";import{getSmartWalletClient as a,useSmartWalletsWrapper as m}from"../lib/smart-wallets.mjs";import{usePrivyInternal as l}from"./internal-context.mjs";import{usePrivyContext as p}from"./privy-context.mjs";import{useWallets as d}from"./useWallets.mjs";import"../config.mjs";import"../configuration/defaultClientConfig.mjs";import"../constants.mjs";import"../configuration/login-methods.mjs";import"../configuration/wallets.mjs";import"../connectors/chains/index.mjs";import"../connectors/chains/arbitrum.mjs";import"../connectors/chains/arbitrumSepolia.mjs";import"../connectors/chains/avalanche.mjs";import"../connectors/chains/avalancheFuji.mjs";import"../connectors/chains/base.mjs";import"../connectors/chains/baseSepolia.mjs";import"../connectors/chains/berachainArtio.mjs";import"../connectors/chains/celo.mjs";import"../connectors/chains/celoAlfajores.mjs";import"../connectors/chains/filecoin.mjs";import"../connectors/chains/filecoinCalibration.mjs";import"../connectors/chains/garnetHolesky.mjs";import"../connectors/chains/holesky.mjs";import"../connectors/chains/linea.mjs";import"../connectors/chains/lineaTestnet.mjs";import"../connectors/chains/lukso.mjs";import"../connectors/chains/mainnet.mjs";import"../connectors/chains/optimism.mjs";import"../connectors/chains/optimismSepolia.mjs";import"../connectors/chains/polygon.mjs";import"../connectors/chains/polygonAmoy.mjs";import"../connectors/chains/redstone.mjs";import"../connectors/chains/sepolia.mjs";import"../connectors/chains/zora.mjs";import"../connectors/chains/zoraSepolia.mjs";import"../connectors/chains/zoraTestnet.mjs";import"../connectors/chains/utils.mjs";import"../lib/solana/index.mjs";import"../theme.mjs";import"tinycolor2";import"../lib/cybr53.mjs";import"ofetch";import"viem";import"../client/user.mjs";import"@ethersproject/address";import"./modal-context.mjs";import"../components/PrefetchedImage.mjs";import"../screens/index.mjs";import"./index.mjs";import"./useSmartWalletChain.mjs";import"../utils/index.mjs";import"@ethersproject/providers";import"../connectors/get-legacy-injected-providers.mjs";import"../connectors/is-wallet-installed.mjs";import"../lib/smart-wallets-shared.mjs";import"permissionless";import"permissionless/accounts";import"permissionless/clients/pimlico";import"viem/account-abstraction";import"@privy-io/js-sdk-core";let h=/*#__PURE__*/e({client:void 0});const j=({config:o,children:t})=>/*#__PURE__*/i(y,{children:/*#__PURE__*/i(v,{config:o,children:/*#__PURE__*/i(b,{children:t})})}),f=()=>{let{client:i}=o(h);return{client:i}};let g=/*#__PURE__*/e({config:void 0}),u=()=>{let{config:i}=o(g);return{config:i}},y=({children:o})=>{let[e,r]=t(void 0),{client:s}=l();return n((()=>{!e&&s&&(async()=>{try{if(!s)return void console.warn("No client found");let i=await s.getSmartWalletsConfig();r(i)}catch(i){console.warn("Error generating smart wallet config: ",i)}})()}),[!!s]),/*#__PURE__*/i(g.Provider,{value:{config:e},children:o})},v=({config:o,children:e})=>{let{config:m}=u(),{appId:h}=l(),{chains:j,defaultChain:f,rpcConfig:g}=r(),{wallets:y}=d(),{user:v}=p(),[b,C]=t(),W=c(y);return n((()=>{(async()=>{if(!m?.enabled)return;let i=m.configuredNetworks.find((i=>i.chainId===`eip155:${f.id}`))?f:j.find((i=>m.configuredNetworks.map((i=>i.chainId)).includes(`eip155:${i.id}`)));if(!i)throw new s("Could not find smart wallets chain configurations for any Privy client configured chains. Please configure smart wallets for your chains in the Privy dashboard.");C(await a({chain:i,privyAppId:h,paymasterContext:o?.paymasterContext,rpcConfig:g,embeddedWallet:W,user:v,smartWalletsConfig:m}))})()}),[!!m?.enabled,!!v?.smartWallet,!!W]),/*#__PURE__*/i(w.Provider,{value:{client:b,config:o},children:e})},w=/*#__PURE__*/e({client:void 0,config:void 0}),b=({children:t})=>{let{client:e,config:r}=(()=>{let{client:i,config:t}=o(w);return{client:i,config:t}})(),{config:s}=u(),{wrapSmartAccountClient:c}=m({clientConfig:r,smartWalletsConfig:s}),{user:a}=p(),{generateSiweMessageForSmartWallet:d,linkSmartWallet:j,noPromptOnSignature:f}=l();return n((()=>{(async()=>{if(e&&a&&!a?.smartWallet&&s?.enabled)try{let i=await d({address:e.account.address,chainId:`eip155:${e.chain.id}`});f.current=!0;let o=await e.signMessage({message:i});await j({signature:o,message:i,smartWalletType:s.smartWalletType})}catch(i){console.error("Error creating smart wallet:",i)}finally{f.current=!1}})()}),[!!e,!!a?.smartWallet,!!s?.enabled]),/*#__PURE__*/i(h.Provider,{value:{client:a?.smartWallet&&e?c(e):void 0},children:t})};export{j as SmartWalletsProvider,f as useSmartWallets};
