import{useCallback as o,useEffect as t}from"react";import{useIsServerConfigLoaded as r}from"../configuration/context.mjs";import{PrivyErrorCode as s}from"../errors.mjs";import{useCaptcha as n,CaptchaError as i}from"./captcha-context.mjs";import{usePrivyEventSubscription as e}from"./events-context.mjs";import{usePrivyInternal as c}from"./internal-context.mjs";import{usePrivyContext as m}from"./privy-context.mjs";import{detectCompletingOAuthFlow as a}from"../auth-flows/oauth/detectCompletingOAuthFlow.mjs";import{stripUrlOAuthParamsAndRemoveStateCode as p}from"../auth-flows/oauth/stripUrlOAuthParamsAndRemoveStateCode.mjs";import"react/jsx-runtime";import"../config.mjs";import"../configuration/defaultClientConfig.mjs";import"../constants.mjs";import"../configuration/login-methods.mjs";import"../configuration/wallets.mjs";import"../connectors/chains/index.mjs";import"../connectors/chains/arbitrum.mjs";import"../connectors/chains/arbitrumSepolia.mjs";import"../connectors/chains/avalanche.mjs";import"../connectors/chains/avalancheFuji.mjs";import"../connectors/chains/base.mjs";import"../connectors/chains/baseSepolia.mjs";import"../connectors/chains/berachainArtio.mjs";import"../connectors/chains/celo.mjs";import"../connectors/chains/celoAlfajores.mjs";import"../connectors/chains/filecoin.mjs";import"../connectors/chains/filecoinCalibration.mjs";import"../connectors/chains/garnetHolesky.mjs";import"../connectors/chains/holesky.mjs";import"../connectors/chains/linea.mjs";import"../connectors/chains/lineaTestnet.mjs";import"../connectors/chains/lukso.mjs";import"../connectors/chains/mainnet.mjs";import"../connectors/chains/optimism.mjs";import"../connectors/chains/optimismSepolia.mjs";import"../connectors/chains/polygon.mjs";import"../connectors/chains/polygonAmoy.mjs";import"../connectors/chains/redstone.mjs";import"../connectors/chains/sepolia.mjs";import"../connectors/chains/zora.mjs";import"../connectors/chains/zoraSepolia.mjs";import"../connectors/chains/zoraTestnet.mjs";import"../connectors/chains/utils.mjs";import"../lib/solana/index.mjs";import"../theme.mjs";import"tinycolor2";import"../lib/cybr53.mjs";import"ofetch";import"./index.mjs";import"../utils/index.mjs";import"@ethersproject/providers";import"../connectors/get-legacy-injected-providers.mjs";import"../connectors/is-wallet-installed.mjs";import"../auth-flows/oauth/getIsHeadlessOAuthFlowInProgress.mjs";import"../storage.mjs";const h=h=>{e("login",h);let l=n(),j=r(),{ready:u,user:f}=m(),{initLoginWithHeadlessOAuth:g,loginWithHeadlessOAuth:d,oAuthState:w,setOAuthState:A,isHeadlessOAuthLoading:y}=c(),b=o((async o=>{try{if(l.enabled&&"success"!==l.status)throw new i(l.error,null,s.CAPTCHA_FAILURE);return await g(o.provider,l.token,o.disableSignup)}catch(o){throw A({status:"error",error:o}),o}}),[g,l]),x=o((async()=>{let o=a();try{if(f)return console.warn("Cannot login with OAuth when already logged in"),f;if(!o.inProgress)throw Error("Cannot login with OAuth because no OAuth flow is in progress");if(o.popupFlow)return}catch(o){throw A({status:"error",error:o}),o}try{return await d(o)}catch(o){throw A({status:"error",error:o}),o}finally{p()}}),[d]);return t((()=>{let o=a();u&&j&&o.inProgress&&!o.withPrivyUi&&!o.popupFlow&&x()}),[u,j]),{initOAuth:b,loading:y,state:w}};export{h as useLoginWithOAuth};
