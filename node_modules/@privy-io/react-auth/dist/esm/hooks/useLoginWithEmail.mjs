import{useCallback as r}from"react";import{PrivyErrorCode as t}from"../errors.mjs";import{useCaptcha as e,CaptchaError as o}from"./captcha-context.mjs";import{usePrivyInternal as i}from"./internal-context.mjs";import"ofetch";import"react/jsx-runtime";import"./index.mjs";import"../utils/index.mjs";import"@ethersproject/providers";import"../connectors/get-legacy-injected-providers.mjs";import"../connectors/is-wallet-installed.mjs";const s=s=>{let a=e(),{emailOtpState:n,setEmailOtpState:l,initLoginWithEmail:c,loginWithCode:m}=i();return{sendCode:r((async({email:r,disableSignup:e})=>{try{let i;if(!r)throw Error("Email required to send OTP code");if(a.enabled&&"error"===a.status)throw new o(a.error,null,t.CAPTCHA_FAILURE);return a.enabled&&"success"!==a.status&&(a.execute(),i=await a.waitForResult()),await c({email:r,captchaToken:i,disableSignup:e,withPrivyUi:!1})}catch(r){throw l({status:"error",error:r}),s?.onError?.(r.privyErrorCode||t.UNKNOWN_AUTH_ERROR),r}}),[c]),loginWithCode:r((async({code:r})=>{try{if(a.enabled&&"error"===a.status)throw new o(a.error,null,t.CAPTCHA_FAILURE);let{user:e,isNewUser:i,wasAlreadyAuthenticated:n,linkedAccount:l}=await m(r);s?.onComplete?.(e,i,n,"email",l)}catch(r){throw l({status:"error",error:r}),s?.onError?.(r.privyErrorCode||t.UNKNOWN_AUTH_ERROR),r}}),[m,a.status]),state:n}};export{s as useLoginWithEmail};
