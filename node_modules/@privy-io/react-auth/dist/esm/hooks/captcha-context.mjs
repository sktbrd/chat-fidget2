import{jsx as e}from"react/jsx-runtime";import{notImplemented as t}from"./index.mjs";import{createContext as r,useRef as s,useState as o,useMemo as i,useContext as a}from"react";import{PrivyError as n,PrivyErrorCode as c}from"../errors.mjs";import{pollForResult as d}from"../utils/index.mjs";import"ofetch";import"@ethersproject/providers";import"../connectors/get-legacy-injected-providers.mjs";import"../connectors/is-wallet-installed.mjs";const u=/*#__PURE__*/r({siteKey:"",enabled:!1,appId:void 0,token:void 0,error:void 0,status:"disabled",setToken:t,setError:t,setExecuting:t,waitForResult:()=>Promise.resolve(""),ref:{current:null},remove:t,reset:t,execute:t});class l extends n{constructor(e,t,r){super(e||"Captcha failed"),this.type="Captcha",t instanceof Error&&(this.cause=t),this.privyErrorCode=r}}const p=({children:t,id:r,captchaSiteKey:a,captchaEnabled:n})=>{let p=s(null),[m,v]=o(),[h,f]=o(),[x,y]=o(!1),j=i((()=>n?x||m||h?!x||m||h?m&&!h?{status:"success",token:m}:h?{status:"error",error:h}:{status:"ready"}:{status:"loading"}:{status:"ready"}:{status:"disabled"}),[n,m,h,x]);/*#__PURE__*/return e(u.Provider,{value:{...j,ref:p,enabled:n,siteKey:a,appId:r,setToken:v,setError:f,setExecuting:y,remove(){n&&(p.current?.remove(),y(!1),f(void 0),v(void 0))},reset(){n&&(p.current?.reset(),y(!1),f(void 0),v(void 0))},execute(){n&&(y(!0),p.current?.execute())},async waitForResult(){if(!n)return"";try{return await d((()=>p.current?.getResponse()),{interval:200,timeout:2e4})}catch(e){throw new l("Captcha failed",null,c.CAPTCHA_TIMEOUT)}}},children:t})},m=()=>a(u);export{u as CaptchaContext,l as CaptchaError,p as CaptchaProvider,m as useCaptcha};
