"use strict";var r=require("react"),e=require("../errors.js"),t=require("./captcha-context.js"),s=require("./internal-context.js");require("ofetch"),require("react/jsx-runtime"),require("./index.js"),require("../utils/index.js"),require("@ethersproject/providers"),require("../connectors/get-legacy-injected-providers.js"),require("../connectors/is-wallet-installed.js");exports.useLoginWithSms=o=>{let i=t.useCaptcha(),{smsOtpState:a,setSmsOtpState:n,initLoginWithSms:u,loginWithCode:c}=s.usePrivyInternal();return{sendCode:r.useCallback((async({phoneNumber:r,disableSignup:s})=>{try{let o;if(!r)throw Error("SMS required to send OTP code");if(i.enabled&&"error"===i.status)throw new t.CaptchaError(i.error,null,e.PrivyErrorCode.CAPTCHA_FAILURE);return i.enabled&&"success"!==i.status&&(i.execute(),o=await i.waitForResult()),await u({phoneNumber:r,captchaToken:o,disableSignup:s,withPrivyUi:!1})}catch(r){throw n({status:"error",error:r}),o?.onError?.(r.privyErrorCode||e.PrivyErrorCode.UNKNOWN_AUTH_ERROR),r}}),[u]),loginWithCode:r.useCallback((async({code:r})=>{try{if(i.enabled&&"success"!==i.status)throw new t.CaptchaError(i.error,null,e.PrivyErrorCode.CAPTCHA_FAILURE);let{user:s,isNewUser:a,wasAlreadyAuthenticated:n,linkedAccount:u}=await c(r);o?.onComplete?.(s,a,n,"sms",u)}catch(r){throw n({status:"error",error:r}),o?.onError?.(r.privyErrorCode||e.PrivyErrorCode.UNKNOWN_AUTH_ERROR),r}}),[c,i.status]),state:a}};
