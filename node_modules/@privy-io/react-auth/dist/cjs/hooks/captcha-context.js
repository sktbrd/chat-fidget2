"use strict";var e=require("react/jsx-runtime"),t=require("./index.js"),r=require("react"),s=require("../errors.js"),o=require("../utils/index.js");require("ofetch"),require("@ethersproject/providers"),require("../connectors/get-legacy-injected-providers.js"),require("../connectors/is-wallet-installed.js");const a=/*#__PURE__*/r.createContext({siteKey:"",enabled:!1,appId:void 0,token:void 0,error:void 0,status:"disabled",setToken:t.notImplemented,setError:t.notImplemented,setExecuting:t.notImplemented,waitForResult:()=>Promise.resolve(""),ref:{current:null},remove:t.notImplemented,reset:t.notImplemented,execute:t.notImplemented});class n extends s.PrivyError{constructor(e,t,r){super(e||"Captcha failed"),this.type="Captcha",t instanceof Error&&(this.cause=t),this.privyErrorCode=r}}exports.CaptchaContext=a,exports.CaptchaError=n,exports.CaptchaProvider=({children:t,id:i,captchaSiteKey:u,captchaEnabled:c})=>{let d=r.useRef(null),[l,p]=r.useState(),[v,m]=r.useState(),[h,x]=r.useState(!1),C=r.useMemo((()=>c?h||l||v?!h||l||v?l&&!v?{status:"success",token:l}:v?{status:"error",error:v}:{status:"ready"}:{status:"loading"}:{status:"ready"}:{status:"disabled"}),[c,l,v,h]);/*#__PURE__*/return e.jsx(a.Provider,{value:{...C,ref:d,enabled:c,siteKey:u,appId:i,setToken:p,setError:m,setExecuting:x,remove(){c&&(d.current?.remove(),x(!1),m(void 0),p(void 0))},reset(){c&&(d.current?.reset(),x(!1),m(void 0),p(void 0))},execute(){c&&(x(!0),d.current?.execute())},async waitForResult(){if(!c)return"";try{return await o.pollForResult((()=>d.current?.getResponse()),{interval:200,timeout:2e4})}catch(e){throw new n("Captcha failed",null,s.PrivyErrorCode.CAPTCHA_TIMEOUT)}}},children:t})},exports.useCaptcha=()=>r.useContext(a);
