"use strict";var e=require("@solana/web3.js"),r=require("react"),s=require("../configuration/context.js"),n=require("../connectors/isBaseConnectedEthereumWallet.js"),i=require("../connectors/solana/index.js"),a=require("../lib/caip2.js"),o=require("../lib/erc20/actions/getErc20TokenInfo.js"),c=require("../lib/erc20/formatErc20TokenAmount.js"),t=require("../lib/wallets/actions/getErc20Balance.js"),l=require("../privy-components/wallets-pill/state.js"),u=require("./internal-context.js");require("react/jsx-runtime"),require("../config.js"),require("../configuration/defaultClientConfig.js"),require("../constants.js"),require("../configuration/login-methods.js"),require("../configuration/wallets.js"),require("../connectors/chains/index.js"),require("../connectors/chains/arbitrum.js"),require("../connectors/chains/arbitrumSepolia.js"),require("../connectors/chains/avalanche.js"),require("../connectors/chains/avalancheFuji.js"),require("../connectors/chains/base.js"),require("../connectors/chains/baseSepolia.js"),require("../connectors/chains/berachainArtio.js"),require("../connectors/chains/celo.js"),require("../connectors/chains/celoAlfajores.js"),require("../connectors/chains/filecoin.js"),require("../connectors/chains/filecoinCalibration.js"),require("../connectors/chains/garnetHolesky.js"),require("../connectors/chains/holesky.js"),require("../connectors/chains/linea.js"),require("../connectors/chains/lineaTestnet.js"),require("../connectors/chains/lukso.js"),require("../connectors/chains/mainnet.js"),require("../connectors/chains/optimism.js"),require("../connectors/chains/optimismSepolia.js"),require("../connectors/chains/polygon.js"),require("../connectors/chains/polygonAmoy.js"),require("../connectors/chains/redstone.js"),require("../connectors/chains/sepolia.js"),require("../connectors/chains/zora.js"),require("../connectors/chains/zoraSepolia.js"),require("../connectors/chains/zoraTestnet.js"),require("../connectors/chains/utils.js"),require("../lib/solana/index.js"),require("../theme.js"),require("tinycolor2"),require("../lib/cybr53.js"),require("./index.js"),require("../types.js"),require("../connectors/base.js"),require("eventemitter3"),require("../connectors/errors.js"),require("@ethersproject/logger"),require("@privy-io/js-sdk-core"),require("../errors.js"),require("ofetch"),require("viem"),require("../utils/index.js"),require("@ethersproject/providers"),require("../connectors/get-legacy-injected-providers.js"),require("../connectors/is-wallet-installed.js"),require("zustand"),require("zustand/shallow"),require("zustand/traditional"),require("../storage.js");let d=async({wallet:e,chains:r,tokens:s,rpcConfig:n,appId:i})=>{let l=r.find((r=>r.id===a.extractChainIdFromCAIP2(e.chainId)));if(!l)return[];let u=s.filter((e=>e.chain.id===l.id)).map((r=>(async({address:e,erc20:r,chain:s,rpcConfig:n,appId:i})=>{let[a,{balance:l}]=await Promise.all([await o.getErc20TokenInfo({chain:s,address:r.address,rpcConfig:n,privyAppId:i}),await t.getErc20Balance({chain:s,address:e,erc20Address:r.address,rpcConfig:n,appId:i})]);if(!a||l<=0n)return;let u=Number(c.formatErc20TokenAmount({amount:l,decimals:a.decimals}).replace(",","")).toFixed(2);return{amount:u,usdAmount:Number(u),symbol:a.symbol,icon:r.icon}})({address:e.address,erc20:r,chain:l,rpcConfig:n,appId:i})));return(await Promise.all(u)).filter((e=>!!e))},q=async({wallet:r,tokens:s,solanaClusters:n})=>{let i=s.map((s=>(async({wallet:r,spl:s,solanaClusters:n})=>{let i=new e.Connection(n[s.cluster],"confirmed"),a=new e.PublicKey(r.address),o=new e.PublicKey(s.address),c=await i.getParsedTokenAccountsByOwner(a,{mint:o});if(c.value.length<=0||!c.value[0])return;let t=Number(c.value[0].account.data.parsed.info.tokenAmount.uiAmount);return t<=0?void 0:{amount:t.toFixed(2),usdAmount:t,symbol:s.ticker,icon:s.icon}})({wallet:r,spl:s,solanaClusters:n})));return(await Promise.all(i)).filter((e=>!!e))};exports.useFormattedBalances=({wallet:e,enabled:a,assets:o})=>{let c=l.useBalance(e.address,"solana"===e.type?"solana":e.chainId),[t,j]=r.useState(!0),{solanaClusters:h}=s.useAppConfig(),{chains:p,rpcConfig:m,appId:f}=u.usePrivyInternal(),g=r.useMemo((()=>(c||[]).map((e=>e.usdAmount)).reduce(((e,r)=>e+r),0)),[c]);return r.useEffect((()=>{a?(async()=>{j(void 0===c),n.isBaseConnectedEthereumWallet(e)?l.updateBalance(e.address,e.chainId,await d({wallet:e,chains:p,tokens:o.ethereum,rpcConfig:m,appId:f})):i.isBaseConnectedSolanaWallet(e)&&l.updateBalance(e.address,"solana",await q({wallet:e,tokens:o.solana,solanaClusters:h})),j(!1)})().catch(console.error):j(!1)}),[e,a]),{balances:c??[],isLoading:t,totalUsdBalance:g}};
