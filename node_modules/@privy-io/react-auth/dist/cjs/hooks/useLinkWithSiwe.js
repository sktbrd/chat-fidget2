"use strict";var e=require("react"),r=require("../errors.js"),t=require("./captcha-context.js"),s=require("./internal-context.js");require("ofetch"),require("react/jsx-runtime"),require("./index.js"),require("../utils/index.js"),require("@ethersproject/providers"),require("../connectors/get-legacy-injected-providers.js"),require("../connectors/is-wallet-installed.js");exports.useLinkWithSiwe=i=>{let a=t.useCaptcha(),{siweState:n,setSiweState:o,linkWithSiwe:c,generateSiweMessage:u}=s.usePrivyInternal();return{generateSiweMessage:e.useCallback((async({address:e,chainId:t})=>{try{if(!e||!t)throw Error("wallet address and chainId required to generate nonce");return await u({address:e,chainId:t}).then((e=>e))}catch(e){throw o({status:"error",error:e}),i?.onError?.(e.privyErrorCode||r.PrivyErrorCode.UNKNOWN_AUTH_ERROR,{linkMethod:"siwe"}),e}}),[u]),linkWithSiwe:e.useCallback((async({signature:e,message:s,chainId:n,walletClientType:u,connectorType:l})=>{try{if(a.enabled&&"success"!==a.status)throw new t.CaptchaError(a.error,null,r.PrivyErrorCode.CAPTCHA_FAILURE);let{user:o,linkedAccount:d}=await c({message:s,signature:e,chainId:n,walletClientType:u,connectorType:l});d&&i?.onSuccess?.(o,"siwe",d)}catch(e){throw o({status:"error",error:e}),i?.onError?.(e.privyErrorCode||r.PrivyErrorCode.UNKNOWN_AUTH_ERROR,{linkMethod:"siwe"}),e}}),[c,a.status]),state:n}};
