"use strict";var r=require("react"),e=require("../errors.js"),t=require("./captcha-context.js"),i=require("./internal-context.js");require("ofetch"),require("react/jsx-runtime"),require("./index.js"),require("../utils/index.js"),require("@ethersproject/providers"),require("../connectors/get-legacy-injected-providers.js"),require("../connectors/is-wallet-installed.js");exports.useLoginWithEmail=o=>{let a=t.useCaptcha(),{emailOtpState:s,setEmailOtpState:n,initLoginWithEmail:l,loginWithCode:u}=i.usePrivyInternal();return{sendCode:r.useCallback((async({email:r,disableSignup:i})=>{try{let o;if(!r)throw Error("Email required to send OTP code");if(a.enabled&&"error"===a.status)throw new t.CaptchaError(a.error,null,e.PrivyErrorCode.CAPTCHA_FAILURE);return a.enabled&&"success"!==a.status&&(a.execute(),o=await a.waitForResult()),await l({email:r,captchaToken:o,disableSignup:i,withPrivyUi:!1})}catch(r){throw n({status:"error",error:r}),o?.onError?.(r.privyErrorCode||e.PrivyErrorCode.UNKNOWN_AUTH_ERROR),r}}),[l]),loginWithCode:r.useCallback((async({code:r})=>{try{if(a.enabled&&"error"===a.status)throw new t.CaptchaError(a.error,null,e.PrivyErrorCode.CAPTCHA_FAILURE);let{user:i,isNewUser:s,wasAlreadyAuthenticated:n,linkedAccount:l}=await u(r);o?.onComplete?.(i,s,n,"email",l)}catch(r){throw n({status:"error",error:r}),o?.onError?.(r.privyErrorCode||e.PrivyErrorCode.UNKNOWN_AUTH_ERROR),r}}),[u,a.status]),state:s}};
