"use strict";var e=require("react"),r=require("../configuration/context.js"),s=require("../errors.js"),i=require("./captcha-context.js"),n=require("./events-context.js"),o=require("./internal-context.js"),t=require("./privy-context.js"),c=require("../auth-flows/oauth/detectCompletingOAuthFlow.js"),a=require("../auth-flows/oauth/stripUrlOAuthParamsAndRemoveStateCode.js");require("react/jsx-runtime"),require("../config.js"),require("../configuration/defaultClientConfig.js"),require("../constants.js"),require("../configuration/login-methods.js"),require("../configuration/wallets.js"),require("../connectors/chains/index.js"),require("../connectors/chains/arbitrum.js"),require("../connectors/chains/arbitrumSepolia.js"),require("../connectors/chains/avalanche.js"),require("../connectors/chains/avalancheFuji.js"),require("../connectors/chains/base.js"),require("../connectors/chains/baseSepolia.js"),require("../connectors/chains/berachainArtio.js"),require("../connectors/chains/celo.js"),require("../connectors/chains/celoAlfajores.js"),require("../connectors/chains/filecoin.js"),require("../connectors/chains/filecoinCalibration.js"),require("../connectors/chains/garnetHolesky.js"),require("../connectors/chains/holesky.js"),require("../connectors/chains/linea.js"),require("../connectors/chains/lineaTestnet.js"),require("../connectors/chains/lukso.js"),require("../connectors/chains/mainnet.js"),require("../connectors/chains/optimism.js"),require("../connectors/chains/optimismSepolia.js"),require("../connectors/chains/polygon.js"),require("../connectors/chains/polygonAmoy.js"),require("../connectors/chains/redstone.js"),require("../connectors/chains/sepolia.js"),require("../connectors/chains/zora.js"),require("../connectors/chains/zoraSepolia.js"),require("../connectors/chains/zoraTestnet.js"),require("../connectors/chains/utils.js"),require("../lib/solana/index.js"),require("../theme.js"),require("tinycolor2"),require("../lib/cybr53.js"),require("ofetch"),require("./index.js"),require("../utils/index.js"),require("@ethersproject/providers"),require("../connectors/get-legacy-injected-providers.js"),require("../connectors/is-wallet-installed.js"),require("../auth-flows/oauth/getIsHeadlessOAuthFlowInProgress.js"),require("../storage.js");exports.useLoginWithOAuth=u=>{n.usePrivyEventSubscription("login",u);let l=i.useCaptcha(),h=r.useIsServerConfigLoaded(),{ready:j,user:q}=t.usePrivyContext(),{initLoginWithHeadlessOAuth:d,loginWithHeadlessOAuth:g,oAuthState:p,setOAuthState:w,isHeadlessOAuthLoading:A}=o.usePrivyInternal(),f=e.useCallback((async e=>{try{if(l.enabled&&"success"!==l.status)throw new i.CaptchaError(l.error,null,s.PrivyErrorCode.CAPTCHA_FAILURE);return await d(e.provider,l.token,e.disableSignup)}catch(e){throw w({status:"error",error:e}),e}}),[d,l]),y=e.useCallback((async()=>{let e=c.detectCompletingOAuthFlow();try{if(q)return console.warn("Cannot login with OAuth when already logged in"),q;if(!e.inProgress)throw Error("Cannot login with OAuth because no OAuth flow is in progress");if(e.popupFlow)return}catch(e){throw w({status:"error",error:e}),e}try{return await g(e)}catch(e){throw w({status:"error",error:e}),e}finally{a.stripUrlOAuthParamsAndRemoveStateCode()}}),[g]);return e.useEffect((()=>{let e=c.detectCompletingOAuthFlow();j&&h&&e.inProgress&&!e.withPrivyUi&&!e.popupFlow&&y()}),[j,h]),{initOAuth:f,loading:A,state:p}};
