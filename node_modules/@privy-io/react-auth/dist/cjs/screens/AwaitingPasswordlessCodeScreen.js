"use strict";var e=require("react/jsx-runtime"),r=require("@heroicons/react/20/solid/CheckIcon"),o=require("@heroicons/react/24/outline/EnvelopeIcon"),i=require("@heroicons/react/24/outline/PhoneIcon"),n=require("react"),t=require("react-device-detect"),s=require("styled-components"),a=require("../client/user.js"),c=require("../components/Layouts.js"),l=require("../components/ModalFooter.js"),d=require("../components/ModalHeader.js"),u=require("../components/ScreenHeader.js"),p=require("../constants.js"),h=require("../errors.js"),m=require("../hooks/internal-context.js"),f=require("../hooks/modal-context.js"),y=require("../hooks/privy-context.js"),v=require("./index.js");function E(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("@ethersproject/address"),require("../svg/protected-by-privy.js"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("../configuration/context.js"),require("../config.js"),require("../configuration/defaultClientConfig.js"),require("../configuration/login-methods.js"),require("../configuration/wallets.js"),require("../connectors/chains/index.js"),require("../connectors/chains/arbitrum.js"),require("../connectors/chains/arbitrumSepolia.js"),require("../connectors/chains/avalanche.js"),require("../connectors/chains/avalancheFuji.js"),require("../connectors/chains/base.js"),require("../connectors/chains/baseSepolia.js"),require("../connectors/chains/berachainArtio.js"),require("../connectors/chains/celo.js"),require("../connectors/chains/celoAlfajores.js"),require("../connectors/chains/filecoin.js"),require("../connectors/chains/filecoinCalibration.js"),require("../connectors/chains/garnetHolesky.js"),require("../connectors/chains/holesky.js"),require("../connectors/chains/linea.js"),require("../connectors/chains/lineaTestnet.js"),require("../connectors/chains/lukso.js"),require("../connectors/chains/mainnet.js"),require("../connectors/chains/optimism.js"),require("../connectors/chains/optimismSepolia.js"),require("../connectors/chains/polygon.js"),require("../connectors/chains/polygonAmoy.js"),require("../connectors/chains/redstone.js"),require("../connectors/chains/sepolia.js"),require("../connectors/chains/zora.js"),require("../connectors/chains/zoraSepolia.js"),require("../connectors/chains/zoraTestnet.js"),require("../connectors/chains/utils.js"),require("../lib/solana/index.js"),require("../theme.js"),require("tinycolor2"),require("../lib/cybr53.js"),require("../hooks/index.js"),require("ofetch"),require("../components/PrefetchedImage.js");var x=/*#__PURE__*/E(r),j=/*#__PURE__*/E(o),C=/*#__PURE__*/E(i);let g=Array(6).fill("");var S,q,_=((S=_||{})[S.RESET_AFTER_DELAY=0]="RESET_AFTER_DELAY",S[S.CLEAR_ON_NEXT_VALID_INPUT=1]="CLEAR_ON_NEXT_VALID_INPUT",S),N=((q=N||{})[q.EMAIL=0]="EMAIL",q[q.SMS=1]="SMS",q);let A=/*#__PURE__*/s.styled.div.withConfig({displayName:"PasswordlessCodeContainer",componentId:"sc-463c12b2-0"})(["display:flex;flex-direction:column;align-items:flex-start;justify-content:center;margin:auto;gap:16px;flex-grow:1;"]),b=/*#__PURE__*/s.styled.div.withConfig({displayName:"CodeInput",componentId:"sc-463c12b2-1"})(["display:flex;flex-direction:column;width:100%;gap:8px;> div:last-child{display:flex;justify-content:center;gap:0.5rem;width:100%;border-radius:var(--privy-border-radius-md);> input{border:1px solid var(--privy-color-foreground-4);background:var(--privy-color-background);border-radius:var(--privy-border-radius-md);padding:8px 10px;height:58px;width:46px;text-align:center;font-size:18px;}> input:focus{border:1px solid var(--privy-color-accent);}> input:invalid{border:1px solid var(--privy-color-error);}> input.success{border:1px solid var(--privy-color-success);}> input.fail{border:1px solid var(--privy-color-error);animation:shake 180ms;animation-iteration-count:2;}}@keyframes shake{0%{transform:translate(1px,0px);}33%{transform:translate(-1px,0px);}67%{transform:translate(-1px,0px);}100%{transform:translate(1px,0px);}}"]),T=/*#__PURE__*/s.styled.div.withConfig({displayName:"InputHelp",componentId:"sc-463c12b2-2"})(["line-height:20px;height:20px;font-size:13px;color:",";display:flex;justify-content:flex-end;width:100%;"],(e=>e.$success?"var(--privy-color-success)":e.$fail?"var(--privy-color-error)":"var(--privy-color-foreground-3)")),I=/*#__PURE__*/s.styled.div.withConfig({displayName:"HelpText",componentId:"sc-463c12b2-3"})(["font-size:13px;color:var(--privy-color-foreground);display:flex;gap:8px;align-items:center;width:100%;margin-top:16px;padding-bottom:32px;"]),R=/*#__PURE__*/s.styled.div.withConfig({displayName:"ResendButtonContainer",componentId:"sc-463c12b2-4"})(["color:var(--privy-color-accent);padding:2px 0;> button{text-decoration:underline;}"]),M=/*#__PURE__*/s.styled.div.withConfig({displayName:"Badge",componentId:"sc-463c12b2-5"})(["display:flex;align-items:center;justify-content:center;border-radius:var(--privy-border-radius-sm);padding:2px 8px;gap:4px;background:var(--privy-color-background-2);color:var(--privy-color-foreground-2);"]),w=/*#__PURE__*/s.styled.span.withConfig({displayName:"BoldWrappingSpan",componentId:"sc-463c12b2-6"})(["font-weight:500;word-break:break-all;"]);exports.AwaitingPasswordlessCodeScreen=()=>{let{app:r,navigate:o,lastScreen:i,navigateBack:s,setModalData:E,onUserCloseViaDialogOrKeybindRef:S}=f.usePrivyModal(),{closePrivyModal:q,resendEmailCode:_,resendSmsCode:N,getAuthMeta:P,loginWithCode:k,updateWallets:O,createAnalyticsEvent:L}=m.usePrivyInternal(),{authenticated:D,logout:U,user:F}=y.usePrivyContext(),[W,H]=n.useState(g),[$,z]=n.useState(!1),[B,K]=n.useState(null),[V,X]=n.useState(null),[Y,Q]=n.useState(0);S.current=()=>null;let G=P()?.email?0:1,J=p.DEFAULT_SUCCESS_SCREEN_DURATION_MS-500;n.useEffect((()=>{if(Y){let e=setTimeout((()=>{Q(Y-1)}),1e3);return()=>clearTimeout(e)}}),[Y]),n.useEffect((()=>{if(D&&$&&F){if(r?.legal.requireUsersAcceptTerms&&!F.hasAcceptedTerms){let e=setTimeout((()=>{o(v.ModalScreen.AFFIRMATIVE_CONSENT_SCREEN)}),J);return()=>clearTimeout(e)}if(a.shouldProceedtoEmbeddedWalletCreationFlow(F,r?.embeddedWallets?.createOnLogin)){let e=setTimeout((()=>{E({createWallet:{onSuccess:()=>{},onFailure:e=>{console.error(e),L({eventName:"embedded_wallet_creation_failure_logout",payload:{error:e,screen:"AwaitingPasswordlessCodeScreen"}}),U()},callAuthOnSuccessOnClose:!0}}),o(v.ModalScreen.EMBEDDED_WALLET_ON_ACCOUNT_CREATE_SCREEN)}),J);return()=>clearTimeout(e)}{O();let e=setTimeout((()=>q({shouldCallAuthOnSuccess:!0,isSuccess:!0})),p.DEFAULT_SUCCESS_SCREEN_DURATION_MS);return()=>clearTimeout(e)}}}),[D,$,F]),n.useEffect((()=>{if(B&&0===V){let e=setTimeout((()=>{H(g),K(null);let e=document.querySelector("input[name=code-0]");e?.focus()}),1400);return()=>clearTimeout(e)}}),[B]);let Z=e=>{e.preventDefault();let r=e.currentTarget.value.replace(" ","");if(""===r)return;if(isNaN(Number(r)))return K("Code should be numeric"),void X(1);K(null),X(null);let n=Number(e.currentTarget.name?.charAt(5)),t=[...r||[""]].slice(0,6-n),s=[...W.slice(0,n),...t,...W.slice(n+t.length)];H(s);let a=Math.min(Math.max(n+t.length,0),5);if(!isNaN(Number(e.currentTarget.value))){let e=document.querySelector(`input[name=code-${a}]`);e?.focus()}if(s.every((e=>e&&!isNaN(+e)))){let e=document.querySelector(`input[name=code-${a}]`);e?.blur(),k(s.join("")).then((()=>z(!0))).catch((e=>{if(e instanceof h.PrivyApiError&&e.privyErrorCode===h.PrivyErrorCode.INVALID_CREDENTIALS)K("Invalid or expired verification code");else if(e instanceof h.PrivyApiError&&e.privyErrorCode===h.PrivyErrorCode.CANNOT_LINK_MORE_OF_TYPE)K(e.message);else{if(e instanceof h.PrivyApiError&&e.privyErrorCode===h.PrivyErrorCode.USER_LIMIT_REACHED)return console.error(new h.PrivyUserLimitReachedError(e).toString()),void o(v.ModalScreen.USER_LIMIT_REACHED_SCREEN);if(e instanceof h.PrivyApiError&&e.privyErrorCode===h.PrivyErrorCode.USER_DOES_NOT_EXIST)return void o(v.ModalScreen.ACCOUNT_NOT_FOUND_SCREEN);if(e instanceof h.PrivyApiError&&e.privyErrorCode===h.PrivyErrorCode.LINKED_TO_ANOTHER_USER)return E({errorModalData:{error:e,previousScreen:i??v.ModalScreen.AWAITING_PASSWORDLESS_CODE}}),void o(v.ModalScreen.ERROR_SCREEN,!1);if(e instanceof h.PrivyApiError&&e.privyErrorCode===h.PrivyErrorCode.DISALLOWED_PLUS_EMAIL)return E({inlineError:{error:e}}),void o(v.ModalScreen.CONNECT_OR_CREATE,!1);if(e instanceof h.PrivyApiError&&e.privyErrorCode===h.PrivyErrorCode.ACCOUNT_TRANSFER_REQUIRED&&e.data?.data?.nonce)return E({accountTransfer:{nonce:e.data?.data?.nonce,account:0===G?P()?.email:P()?.phoneNumber,displayName:e.data?.data?.account?.displayName,linkMethod:0===G?"email":"sms",embeddedWalletAddress:e.data?.data?.otherUser?.embeddedWalletAddress}}),void o(v.ModalScreen.LINK_CONFLICT_SCREEN);K("Issue verifying code")}X(0)}))}},ee=0==G?/*#__PURE__*/e.jsx(j.default,{color:"var(--privy-color-accent)",strokeWidth:2,height:"48px",width:"48px"}):
/*#__PURE__*/e.jsx(C.default,{color:"var(--privy-color-accent)",strokeWidth:2,height:"40px",width:"40px"}),re=0==G?/*#__PURE__*/e.jsxs("p",{children:["Please check ",/*#__PURE__*/e.jsx(w,{children:P()?.email})," for an email from privy.io and enter your code below."]}):/*#__PURE__*/e.jsxs("p",{children:["Please check ",/*#__PURE__*/e.jsx(w,{children:P()?.phoneNumber})," for a message from ",r?.name||"Privy"," and enter your code below."]});/*#__PURE__*/return e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(d.ModalHeader,{backFn:()=>s()},"header"),/*#__PURE__*/e.jsxs(A,{children:[/*#__PURE__*/e.jsx(u.CenteredScreenHeader,{title:"Enter confirmation code",description:re,icon:ee}),/*#__PURE__*/e.jsxs(c.HorizontallyCenteredItem,{children:[/*#__PURE__*/e.jsxs(b,{children:[/*#__PURE__*/e.jsx(T,{$fail:!!B,$success:$,children:/*#__PURE__*/e.jsx("span",{children:B||($?"Success!":"")})}),/*#__PURE__*/e.jsx("div",{children:W.map(((r,o)=>/*#__PURE__*/e.jsx("input",{name:`code-${o}`,type:"text",value:W[o],onChange:Z,onKeyUp:e=>{"Backspace"===e.key&&(e=>{if(1===V&&(K(null),X(null)),H([...W.slice(0,e),"",...W.slice(e+1)]),e>0){let r=document.querySelector(`input[name=code-${e-1}]`);r?.focus()}})(o)},inputMode:"numeric",autoFocus:0===o,pattern:"[0-9]",className:`${$?"success":""} ${B?"fail":""}`,autoComplete:t.isMobile?"one-time-code":"off"},o)))})]}),/*#__PURE__*/e.jsxs(I,{children:[/*#__PURE__*/e.jsxs("span",{children:["Didn't get ",0==G?"an email":"a message","?"]}),Y?/*#__PURE__*/e.jsxs(M,{children:[/*#__PURE__*/e.jsx(x.default,{color:"var(--privy-color-foreground)",strokeWidth:1.33,height:"12px",width:"12px"}),/*#__PURE__*/e.jsx("span",{children:"Code sent"})]}):/*#__PURE__*/e.jsx(R,{children:/*#__PURE__*/e.jsx("button",{onClick:async()=>{Q(30),0==G?await _():await N()},children:"Resend code"})})]})]})]}),/*#__PURE__*/e.jsx(l.BlobbyFooter,{})]})};
