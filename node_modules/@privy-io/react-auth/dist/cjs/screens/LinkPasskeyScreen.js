"use strict";var e=require("react/jsx-runtime"),r=require("@heroicons/react/24/outline/CheckCircleIcon"),n=require("@heroicons/react/24/outline/ClockIcon"),i=require("@heroicons/react/24/outline/TrashIcon"),o=require("@heroicons/react/24/solid/CheckBadgeIcon"),t=require("@heroicons/react/24/solid/LockClosedIcon"),s=require("react"),c=require("styled-components"),a=require("../components/Button.js"),l=require("../components/Loader.js"),d=require("../components/ModalFooter.js"),u=require("../components/ModalHeader.js"),h=require("../errors.js"),p=require("../hooks/internal-context.js"),j=require("../hooks/privy-context.js"),m=require("../svg/face-id.js"),y=require("../svg/fingerprint.js"),x=require("./MfaScreens/StyledComponents.js");function g(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("../svg/protected-by-privy.js"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("../configuration/context.js"),require("../config.js"),require("../configuration/defaultClientConfig.js"),require("../constants.js"),require("../configuration/login-methods.js"),require("../configuration/wallets.js"),require("../connectors/chains/index.js"),require("../connectors/chains/arbitrum.js"),require("../connectors/chains/arbitrumSepolia.js"),require("../connectors/chains/avalanche.js"),require("../connectors/chains/avalancheFuji.js"),require("../connectors/chains/base.js"),require("../connectors/chains/baseSepolia.js"),require("../connectors/chains/berachainArtio.js"),require("../connectors/chains/celo.js"),require("../connectors/chains/celoAlfajores.js"),require("../connectors/chains/filecoin.js"),require("../connectors/chains/filecoinCalibration.js"),require("../connectors/chains/garnetHolesky.js"),require("../connectors/chains/holesky.js"),require("../connectors/chains/linea.js"),require("../connectors/chains/lineaTestnet.js"),require("../connectors/chains/lukso.js"),require("../connectors/chains/mainnet.js"),require("../connectors/chains/optimism.js"),require("../connectors/chains/optimismSepolia.js"),require("../connectors/chains/polygon.js"),require("../connectors/chains/polygonAmoy.js"),require("../connectors/chains/redstone.js"),require("../connectors/chains/sepolia.js"),require("../connectors/chains/zora.js"),require("../connectors/chains/zoraSepolia.js"),require("../connectors/chains/zoraTestnet.js"),require("../connectors/chains/utils.js"),require("../lib/solana/index.js"),require("../theme.js"),require("tinycolor2"),require("../lib/cybr53.js"),require("../hooks/index.js"),require("ofetch");var f=/*#__PURE__*/g(r),v=/*#__PURE__*/g(n),q=/*#__PURE__*/g(i),k=/*#__PURE__*/g(o),I=/*#__PURE__*/g(t);let w=({passkeys:r,expanded:n,onUnlink:i,onExpand:o})=>{let[t,c]=s.useState([]),a=n?r.length:2;/*#__PURE__*/return e.jsxs("div",{children:[/*#__PURE__*/e.jsx(A,{children:"Your passkeys"}),/*#__PURE__*/e.jsxs(N,{children:[r.slice(0,a).map((r=>{/*#__PURE__*/return e.jsxs(z,{children:[/*#__PURE__*/e.jsxs("div",{children:[/*#__PURE__*/e.jsx(F,{children:(n=r,n.authenticatorName?n.createdWithBrowser?`${n.authenticatorName} on ${n.createdWithBrowser}`:n.authenticatorName:n.createdWithBrowser?n.createdWithOs?`${n.createdWithBrowser} on ${n.createdWithOs}`:`${n.createdWithBrowser}`:"Unknown device")}),/*#__PURE__*/e.jsxs(T,{children:["Last used: ",(r.latestVerifiedAt??r.verifiedAt).toLocaleString()]})]}),/*#__PURE__*/e.jsx(_,{disabled:t.includes(r.credentialId),onClick:()=>(async e=>{c((r=>r.concat([e]))),await i(e),c((r=>r.filter((r=>r!==e))))})(r.credentialId),children:t.includes(r.credentialId)?/*#__PURE__*/e.jsx(l.ButtonLoader,{}):/*#__PURE__*/e.jsx(q.default,{height:"1.6em"})})]},r.credentialId);var n})),r.length>2&&!n&&/*#__PURE__*/e.jsx(P,{onClick:o,children:"View all"})]})]})},b=()=>/*#__PURE__*/e.jsxs(N,{children:[/*#__PURE__*/e.jsxs(x.ListItem,{children:[/*#__PURE__*/e.jsx(x.ListItemIcon,{children:/*#__PURE__*/e.jsx(k.default,{})}),"Log in with Touch ID, Face ID, or a security key."]}),/*#__PURE__*/e.jsxs(x.ListItem,{children:[/*#__PURE__*/e.jsx(x.ListItemIcon,{children:/*#__PURE__*/e.jsx(I.default,{})}),"More secure than a password."]}),/*#__PURE__*/e.jsxs(x.ListItem,{children:[/*#__PURE__*/e.jsx(x.ListItemIcon,{children:/*#__PURE__*/e.jsx(v.default,{})}),"Takes seconds to set up and use."]})]});const C=/*#__PURE__*/c.styled.div.withConfig({displayName:"DoubleIconWrapper",componentId:"sc-302702bc-0"})(["display:flex;align-items:center;justify-content:center;width:180px;height:90px;border-radius:50%;svg + svg{margin-left:12px;}> svg{z-index:2;color:var(--privy-color-accent) !important;stroke:var(--privy-color-accent) !important;fill:var(--privy-color-accent) !important;}"]);let S=/*#__PURE__*/c.styled.div.withConfig({displayName:"InputHelp",componentId:"sc-302702bc-1"})(["line-height:20px;height:20px;font-size:13px;color:",";display:flex;justify-content:flex-beginngin;width:100%;"],(e=>e.$fail?"var(--privy-color-error)":"var(--privy-color-foreground-3)")),L=/*#__PURE__*/c.css(["&&{width:100%;font-size:0.875rem;line-height:1rem;@media (min-width:440px){font-size:14px;}display:flex;gap:12px;justify-content:center;padding:6px 8px;background-color:var(--privy-color-background);transition:background-color 200ms ease;color:var(--privy-color-accent) !important;:focus{outline:none;box-shadow:none;}}"]);const P=/*#__PURE__*/c.styled.button.withConfig({displayName:"LinkButton",componentId:"sc-302702bc-2"})(["",""],L);let N=/*#__PURE__*/c.styled.div.withConfig({displayName:"List",componentId:"sc-302702bc-3"})(["display:flex;flex-direction:column;align-items:stretch;gap:0.8rem;padding:0.5rem 0rem 0rem;flex-grow:1;width:100%;"]),M=/*#__PURE__*/c.styled.div.withConfig({displayName:"ModalTitle",componentId:"sc-302702bc-4"})(["font-size:18px;line-height:18px;text-align:center;font-weight:600;"]),E=/*#__PURE__*/c.styled.div.withConfig({displayName:"ModalSubTitle",componentId:"sc-302702bc-5"})(["font-size:0.875rem;text-align:center;margin-top:10px;"]),B=/*#__PURE__*/c.styled.div.withConfig({displayName:"SectionSpacer",componentId:"sc-302702bc-6"})(["height:32px;"]),A=/*#__PURE__*/c.styled.div.withConfig({displayName:"PasskeyListTitle",componentId:"sc-302702bc-7"})(["line-height:20px;height:20px;font-size:1em;font-weight:450;display:flex;justify-content:flex-beginning;width:100%;"]),F=/*#__PURE__*/c.styled.div.withConfig({displayName:"PasskeyItemTitle",componentId:"sc-302702bc-8"})(["font-size:1em;line-height:1.3em;font-weight:500;color:var(--privy-color-foreground-2);padding:0.2em 0;"]),T=/*#__PURE__*/c.styled.div.withConfig({displayName:"PasskeyItemSubtitle",componentId:"sc-302702bc-9"})(["font-size:0.875rem;line-height:1rem;color:#64668b;padding:0.2em 0;"]),z=/*#__PURE__*/c.styled.div.withConfig({displayName:"PasskeyListItem",componentId:"sc-302702bc-10"})(["display:flex;align-items:center;justify-content:space-between;padding:1em;gap:10px;font-size:0.875rem;line-height:1rem;text-align:left;border-radius:8px;border:1px solid #e2e3f0 !important;width:100%;height:5em;"]),W=/*#__PURE__*/c.css([":focus,:hover,:active{outline:none;}display:flex;width:2em;height:2em;justify-content:center;align-items:center;svg{color:var(--privy-color-error);}svg:hover{color:var(--privy-color-foreground-3);}"]),_=/*#__PURE__*/c.styled.button.withConfig({displayName:"PasskeyItemUnlinkButton",componentId:"sc-302702bc-11"})(["",""],W);exports.DoubleIconWrapper=C,exports.LinkButton=P,exports.LinkPasskeyScreen=()=>{let{user:r,unlinkPasskey:n}=j.usePrivyContext(),{linkWithPasskey:i,closePrivyModal:o}=p.usePrivyInternal(),t=r?.linkedAccounts.filter((e=>"passkey"===e.type)),[c,l]=s.useState(!1),[g,v]=s.useState(""),[q,k]=s.useState(!1),[I,L]=s.useState(!1);s.useEffect((()=>{0===t.length&&L(!1)}),[t.length]);let P=async e=>(l(!0),await n(e).then((()=>k(!0))).catch((e=>{e instanceof h.PrivyError&&e.privyErrorCode===h.PrivyErrorCode.MISSING_MFA_CREDENTIALS?v("Cannot unlink a passkey enrolled in MFA"):v("Unknown error occurred.")})).finally((()=>{l(!1)})));return q?/*#__PURE__*/e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(u.ModalHeader,{onClose:()=>o()},"header"),/*#__PURE__*/e.jsx(x.IconWrapper,{style:{marginBottom:"1.5rem"},children:/*#__PURE__*/e.jsx(f.default,{})}),/*#__PURE__*/e.jsx(M,{style:{marginBottom:"1.5rem"},children:"Passkeys updated"}),/*#__PURE__*/e.jsx(E,{children:" "}),/*#__PURE__*/e.jsx(x.BottomSection,{children:/*#__PURE__*/e.jsx(a.PrimaryButton,{onClick:()=>o(),children:"Done"})}),/*#__PURE__*/e.jsx(d.ModalFooter,{})]}):I?/*#__PURE__*/e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(u.ModalHeader,{backFn:()=>L(!1),onClose:()=>o()},"header"),/*#__PURE__*/e.jsx(w,{passkeys:t,expanded:I,onUnlink:P,onExpand:()=>L(!0)}),/*#__PURE__*/e.jsx(d.ModalFooter,{})]}):/*#__PURE__*/e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(u.ModalHeader,{onClose:()=>o()},"header"),/*#__PURE__*/e.jsx(x.AppLogoContainer,{children:/*#__PURE__*/e.jsxs(C,{children:[/*#__PURE__*/e.jsx(m.FaceId,{}),/*#__PURE__*/e.jsx(y.FingerPrint,{})]})}),/*#__PURE__*/e.jsx(M,{children:"Secure your account with a passkey"}),/*#__PURE__*/e.jsx(B,{}),0===t.length?/*#__PURE__*/e.jsx(b,{}):/*#__PURE__*/e.jsx(w,{passkeys:t,expanded:I,onUnlink:P,onExpand:()=>L(!0)}),/*#__PURE__*/e.jsxs(x.BottomSection,{style:{marginTop:"12px"},children:[g&&/*#__PURE__*/e.jsx(S,{$fail:!0,children:g}),/*#__PURE__*/e.jsx(a.PrimaryButton,{onClick:()=>{l(!0),i().then((()=>k(!0))).catch((e=>{if(e instanceof h.PrivyError){if(e.privyErrorCode===h.PrivyErrorCode.CANNOT_LINK_MORE_OF_TYPE)return void v("Cannot link more passkeys to account.");if(e.privyErrorCode===h.PrivyErrorCode.PASSKEY_NOT_ALLOWED)return void v("Passkey request timed out or rejected by user.")}v("Unknown error occurred.")})).finally((()=>{l(!1)}))},loading:c,children:"Add new passkey"})]}),/*#__PURE__*/e.jsx(d.ModalFooter,{})]})};
