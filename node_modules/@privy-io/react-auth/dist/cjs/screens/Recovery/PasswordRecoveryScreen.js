"use strict";var e=require("react/jsx-runtime"),r=require("@heroicons/react/24/outline/ShieldCheckIcon"),o=require("react"),n=require("styled-components"),s=require("../../client/user.js"),i=require("../../components/Button.js"),t=require("../../components/Layouts.js"),c=require("../../components/ModalFooter.js"),a=require("../../components/ModalHeader.js"),l=require("../../components/embedded-wallets/SetWalletPasswordForm/shared.js"),d=require("../../embedded-wallets/errors.js"),u=require("../../errors.js"),h=require("../../hooks/internal-context.js"),j=require("../../hooks/modal-context.js"),y=require("../../hooks/privy-context.js");function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("@ethersproject/address"),require("../../components/Loader.js"),require("../../svg/protected-by-privy.js"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("../../configuration/context.js"),require("../../config.js"),require("../../configuration/defaultClientConfig.js"),require("../../constants.js"),require("../../configuration/login-methods.js"),require("../../configuration/wallets.js"),require("../../connectors/chains/index.js"),require("../../connectors/chains/arbitrum.js"),require("../../connectors/chains/arbitrumSepolia.js"),require("../../connectors/chains/avalanche.js"),require("../../connectors/chains/avalancheFuji.js"),require("../../connectors/chains/base.js"),require("../../connectors/chains/baseSepolia.js"),require("../../connectors/chains/berachainArtio.js"),require("../../connectors/chains/celo.js"),require("../../connectors/chains/celoAlfajores.js"),require("../../connectors/chains/filecoin.js"),require("../../connectors/chains/filecoinCalibration.js"),require("../../connectors/chains/garnetHolesky.js"),require("../../connectors/chains/holesky.js"),require("../../connectors/chains/linea.js"),require("../../connectors/chains/lineaTestnet.js"),require("../../connectors/chains/lukso.js"),require("../../connectors/chains/mainnet.js"),require("../../connectors/chains/optimism.js"),require("../../connectors/chains/optimismSepolia.js"),require("../../connectors/chains/polygon.js"),require("../../connectors/chains/polygonAmoy.js"),require("../../connectors/chains/redstone.js"),require("../../connectors/chains/sepolia.js"),require("../../connectors/chains/zora.js"),require("../../connectors/chains/zoraSepolia.js"),require("../../connectors/chains/zoraTestnet.js"),require("../../connectors/chains/utils.js"),require("../../lib/solana/index.js"),require("../../theme.js"),require("tinycolor2"),require("../../lib/cybr53.js"),require("../../hooks/index.js"),require("@heroicons/react/24/outline/ArrowPathIcon"),require("@heroicons/react/24/outline/EyeIcon"),require("@heroicons/react/24/outline/EyeSlashIcon"),require("../../embedded-wallets/types.js"),require("ofetch"),require("../../components/PrefetchedImage.js"),require("../index.js");var q=/*#__PURE__*/p(r);const m=/*#__PURE__*/n.styled.div.withConfig({displayName:"Header",componentId:"sc-858d1103-0"})(["display:flex;flex-direction:column;align-items:center;justify-content:center;margin:20px 0;gap:4px;& h3{font-size:18px;font-style:normal;font-weight:600;line-height:24px;}& p{max-width:300px;font-size:14px;font-style:normal;font-weight:400;line-height:20px;}"]);let v=/*#__PURE__*/n.styled.div.withConfig({displayName:"Content",componentId:"sc-858d1103-1"})(["display:flex;flex-direction:column;justify-content:space-between;"]),f=/*#__PURE__*/n.styled.div.withConfig({displayName:"ErrorMessage",componentId:"sc-858d1103-2"})(["line-height:20px;height:20px;font-size:13px;color:var(--privy-color-error);text-align:left;margin-top:0.5rem;"]),x=/*#__PURE__*/n.styled(i.PrimaryButton).withConfig({displayName:"NoAnimationPrimaryButton",componentId:"sc-858d1103-3"})(["",""],(e=>e.hideAnimations&&/*#__PURE__*/n.css(["&&{transition:none;}"])));exports.Header=m,exports.PasswordRecoveryScreen=()=>{let[r,n]=o.useState(!0),{authenticated:i,getAccessToken:p,user:g}=y.usePrivyContext(),{walletProxy:w,closePrivyModal:b,createAnalyticsEvent:I}=h.usePrivyInternal(),{navigate:C,data:P,onUserCloseViaDialogOrKeybindRef:S}=j.usePrivyModal(),[A,k]=o.useState(void 0),[R,E]=o.useState(""),[M,N]=o.useState(!1),{entropyId:T,entropyIdVerifier:z,onCompleteNavigateTo:F,onSuccess:H,onFailure:W}=P.recoverWallet,_=(e="User exited before their wallet could be recovered")=>{b({shouldCallAuthOnSuccess:!1}),W("string"==typeof e?new u.PrivyEmbeddedWalletError(e):e)};S.current=_,o.useEffect((()=>{if(!i)return _("User must be authenticated and have a Privy wallet before it can be recovered")}),[i]);/*#__PURE__*/return e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(a.ModalHeader,{onClose:_}),/*#__PURE__*/e.jsx(t.RefactorSpacerTop,{}),/*#__PURE__*/e.jsxs(v,{children:[/*#__PURE__*/e.jsxs(m,{children:[/*#__PURE__*/e.jsx(q.default,{height:48,width:48,stroke:"var(--privy-color-accent)"}),/*#__PURE__*/e.jsx("h3",{style:{color:"var(--privy-color-foreground)"},children:"Enter your password"}),/*#__PURE__*/e.jsx("p",{style:{color:"var(--privy-color-foreground-2)"},children:"Please provision your account on this new device. To continue, enter your recovery password."})]}),/*#__PURE__*/e.jsxs("div",{children:[/*#__PURE__*/e.jsxs(l.PasswordContainer,{children:[/*#__PURE__*/e.jsx(l.PasswordInput,{type:r?"password":"text",onChange:e=>(e=>{e&&k(e)})(e.target.value),disabled:M,style:{paddingRight:"2.3rem"}}),/*#__PURE__*/e.jsx(l.InputRightIcons,{style:{right:"0.75rem"},children:r?/*#__PURE__*/e.jsx(l.HiddenIcon,{onClick:()=>n(!1)}):/*#__PURE__*/e.jsx(l.ShownIcon,{onClick:()=>n(!0)})})]}),!!R&&/*#__PURE__*/e.jsx(f,{children:R})]}),/*#__PURE__*/e.jsxs("div",{children:[/*#__PURE__*/e.jsxs(t.StyledCalloutSection,{children:[/*#__PURE__*/e.jsx("h4",{children:"Why is this necessary?"}),/*#__PURE__*/e.jsx("p",{children:"You previously set a password for this wallet. This helps ensure only you can access it"})]}),/*#__PURE__*/e.jsx(x,{loading:M||!w,disabled:!A,onClick:async()=>{N(!0);let e=await p(),r=s.getPrivyWalletWithAddress(g,T);if(!e||!r||null===A)return _("User must be authenticated and have a Privy wallet before it can be recovered");try{I({eventName:"embedded_wallet_recovery_started",payload:{walletAddress:r.address}}),await(w?.recover({accessToken:e,entropyId:T,entropyIdVerifier:z,recoveryPassword:A})),E(""),F?C(F):b({shouldCallAuthOnSuccess:!1}),H?.(r),I({eventName:"embedded_wallet_recovery_completed",payload:{walletAddress:r.address}})}catch(e){d.errorIndicatesInvalidRecoveryPassword(e)?E("Invalid recovery password, please try again."):E("An error has occurred, please try again.")}finally{N(!1)}},warn:!1,hideAnimations:!T&&M,children:"Recover your account"})]})]}),/*#__PURE__*/e.jsx(t.RefactorSpacerBottom,{}),/*#__PURE__*/e.jsx(c.BlobbyFooter,{})]})};
