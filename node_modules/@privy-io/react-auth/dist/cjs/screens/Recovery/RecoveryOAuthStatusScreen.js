"use strict";var e=require("react/jsx-runtime"),r=require("react"),o=require("../../components/Button.js"),n=require("../../components/ModalFooter.js"),s=require("../../components/ModalHeader.js"),i=require("../../components/ScreenHeader.js"),t=require("../../constants.js"),c=require("../../effect.js"),a=require("../../hooks/internal-context.js"),u=require("../../hooks/modal-context.js"),l=require("../../hooks/privy-context.js"),h=require("../../svg/apple-icloud.js"),d=require("../../svg/google-drive.js"),j=require("../index.js"),q=require("./styles.js"),y=require("../../auth-flows/oauth/stripUrlOAuthParamsAndRemoveStateCode.js");require("styled-components"),require("../../components/Loader.js"),require("../../svg/protected-by-privy.js"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("../../configuration/context.js"),require("../../config.js"),require("../../configuration/defaultClientConfig.js"),require("../../configuration/login-methods.js"),require("../../configuration/wallets.js"),require("../../connectors/chains/index.js"),require("../../connectors/chains/arbitrum.js"),require("../../connectors/chains/arbitrumSepolia.js"),require("../../connectors/chains/avalanche.js"),require("../../connectors/chains/avalancheFuji.js"),require("../../connectors/chains/base.js"),require("../../connectors/chains/baseSepolia.js"),require("../../connectors/chains/berachainArtio.js"),require("../../connectors/chains/celo.js"),require("../../connectors/chains/celoAlfajores.js"),require("../../connectors/chains/filecoin.js"),require("../../connectors/chains/filecoinCalibration.js"),require("../../connectors/chains/garnetHolesky.js"),require("../../connectors/chains/holesky.js"),require("../../connectors/chains/linea.js"),require("../../connectors/chains/lineaTestnet.js"),require("../../connectors/chains/lukso.js"),require("../../connectors/chains/mainnet.js"),require("../../connectors/chains/optimism.js"),require("../../connectors/chains/optimismSepolia.js"),require("../../connectors/chains/polygon.js"),require("../../connectors/chains/polygonAmoy.js"),require("../../connectors/chains/redstone.js"),require("../../connectors/chains/sepolia.js"),require("../../connectors/chains/zora.js"),require("../../connectors/chains/zoraSepolia.js"),require("../../connectors/chains/zoraTestnet.js"),require("../../connectors/chains/utils.js"),require("../../lib/solana/index.js"),require("../../theme.js"),require("tinycolor2"),require("../../lib/cybr53.js"),require("../../hooks/index.js"),require("../../components/PrefetchedImage.js"),require("../../storage.js");let p={"google-drive":{name:"Google Drive",component:d.GoogleDrive},icloud:{name:"iCloud",component:h.AppleICloud}};exports.RecoveryOAuthScreen=()=>{let{logout:h}=l.usePrivyContext(),{navigate:d,setModalData:v,data:m}=u.usePrivyModal(),{recoveryOAuthFlow:g,closePrivyModal:f,createAnalyticsEvent:w}=a.usePrivyInternal(),[x,C]=r.useState(!1),{provider:S,action:A,isInAccountCreateFlow:b}=m?.recoveryOAuthStatus,[k,E]=r.useState(void 0),[R,M]=r.useState("create-wallet"===A);if("user-passcode"===S)throw Error("RecoveryOAuthScreen should never be called with a wallet that specifies recoveryMethod: `user-passcode`");let O=p[S].name,T=p[S].component,P=m?.recoverWallet?.onCompleteNavigateTo,_=new c.RunEffectOnce((async(e="create-wallet")=>(M(!0),new Promise(((r,o)=>{setTimeout((async()=>{try{let o=window.open();await g(S,e,o),C(!0),r()}catch(r){E({message:`${"recover"===e?"Recovery":"Back up"} with ${O} unsuccessful`,detail:"recover"===A?`Please verify that you are selecting the ${O} account associated with your backup.`:"",retryable:!0}),o()}}),0)})))));r.useEffect((()=>{"recover"!==A&&_.execute(b?"create-wallet":"set-recovery")}),[]),r.useEffect((()=>{if(!x)return;let e=setTimeout((()=>{b?(v({createWallet:{onSuccess:()=>{},onFailure:e=>{w({eventName:"embedded_wallet_creation_failure_logout",payload:{error:e,screen:"RecoveryOAuthScreen"}}),h()},callAuthOnSuccessOnClose:!0}}),d(j.ModalScreen.EMBEDDED_WALLET_CREATED_SCREEN)):f({shouldCallAuthOnSuccess:!1})}),t.DEFAULT_SUCCESS_SCREEN_DURATION_MS);return()=>clearTimeout(e)}),[x]);let D=r.useCallback((async()=>{await _.execute("recover"),P?d(P):C(!0)}),[]),F="google-drive"===S?"Google Drive":"Apple iCloud",I=x&&`Successfully ${"recover"===A?"recovered":"backed up"} with ${F}.`||k&&k.message||`${"recover"===A?"Recovering":"Backing up"} with ${F}...`,$=k?k.detail:"";/*#__PURE__*/return e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(s.ModalHeader,{}),R?/*#__PURE__*/e.jsx(e.Fragment,{children:/*#__PURE__*/e.jsxs(q.RecoveryContainer,{children:[/*#__PURE__*/e.jsx(i.CenteredScreenHeader,{title:I,icon:/*#__PURE__*/e.jsx(T,{style:{width:"38px",height:"38px"}}),description:$}),k&&k?.retryable?/*#__PURE__*/e.jsx(o.PrimaryButton,{onClick:()=>{y.stripUrlOAuthParamsAndRemoveStateCode(),E(void 0),"create-wallet"===A?_.execute("create-wallet"):D()},disabled:!x&&!k?.retryable,children:"Try again"}):null]})}):/*#__PURE__*/e.jsxs(q.RecoveryContainer,{children:[/*#__PURE__*/e.jsx(i.CenteredScreenHeader,{title:"Confirm it's really you",icon:/*#__PURE__*/e.jsx(T,{style:{height:42,width:48}}),description:`To confirm your identity, please log in to ${F} where your account is backed up.`}),/*#__PURE__*/e.jsxs(o.PrimaryButton,{onClick:D,children:["Confirm with ",F]})]}),/*#__PURE__*/e.jsx(n.BlobbyFooter,{})]})};
