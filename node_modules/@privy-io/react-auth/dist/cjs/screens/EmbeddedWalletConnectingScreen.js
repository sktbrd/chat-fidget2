"use strict";var e=require("react/jsx-runtime"),r=require("@heroicons/react/24/solid/XCircleIcon"),o=require("react"),n=require("styled-components"),t=require("../client/user.js"),i=require("../components/Button.js"),s=require("../components/Layouts.js"),c=require("../components/ModalHeader.js"),a=require("../components/ScreenHeader.js"),l=require("../components/primitives/LoadingSpinner/index.js"),u=require("../embedded-wallets/errors.js"),d=require("../hooks/internal-context.js"),h=require("../hooks/modal-context.js"),j=require("../hooks/privy-context.js"),q=require("../lib/embeddedWalletRecovery.js"),y=require("./index.js");function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("@ethersproject/address"),require("../components/Loader.js"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("../configuration/context.js"),require("../config.js"),require("../configuration/defaultClientConfig.js"),require("../constants.js"),require("../configuration/login-methods.js"),require("../configuration/wallets.js"),require("../connectors/chains/index.js"),require("../connectors/chains/arbitrum.js"),require("../connectors/chains/arbitrumSepolia.js"),require("../connectors/chains/avalanche.js"),require("../connectors/chains/avalancheFuji.js"),require("../connectors/chains/base.js"),require("../connectors/chains/baseSepolia.js"),require("../connectors/chains/berachainArtio.js"),require("../connectors/chains/celo.js"),require("../connectors/chains/celoAlfajores.js"),require("../connectors/chains/filecoin.js"),require("../connectors/chains/filecoinCalibration.js"),require("../connectors/chains/garnetHolesky.js"),require("../connectors/chains/holesky.js"),require("../connectors/chains/linea.js"),require("../connectors/chains/lineaTestnet.js"),require("../connectors/chains/lukso.js"),require("../connectors/chains/mainnet.js"),require("../connectors/chains/optimism.js"),require("../connectors/chains/optimismSepolia.js"),require("../connectors/chains/polygon.js"),require("../connectors/chains/polygonAmoy.js"),require("../connectors/chains/redstone.js"),require("../connectors/chains/sepolia.js"),require("../connectors/chains/zora.js"),require("../connectors/chains/zoraSepolia.js"),require("../connectors/chains/zoraTestnet.js"),require("../connectors/chains/utils.js"),require("../lib/solana/index.js"),require("../theme.js"),require("tinycolor2"),require("../lib/cybr53.js"),require("../hooks/index.js"),require("../embedded-wallets/types.js"),require("../components/PrefetchedImage.js"),require("../errors.js"),require("ofetch"),require("../paths.js"),require("../lib/pkce.js"),require("jose"),require("../crypto.js"),require("../storage.js");var m=/*#__PURE__*/p(r);let v=/*#__PURE__*/n.styled.div.withConfig({displayName:"BottomSpacing",componentId:"sc-124dbb1c-0"})(["height:44px;"]);exports.EmbeddedWalletConnectingScreen=()=>{let{authenticated:r,user:n,getAccessToken:p}=j.usePrivyContext(),{closePrivyModal:f,createAnalyticsEvent:b,walletProxy:g}=d.usePrivyInternal(),{navigate:w,data:x,setModalData:I,onUserCloseViaDialogOrKeybindRef:C}=h.usePrivyModal(),S=o.useMemo((()=>Date.now()),[]),[A,M]=o.useState(!1),{onCompleteNavigateTo:k,onFailure:E,shouldForceMFA:P,entropyId:T,entropyIdVerifier:_}=x?.connectWallet,W=e=>{A||(M(!0),E("string"==typeof e?Error(e):e))};o.useEffect((()=>{let e,o=t.getPrivyWalletWithAddress(n,T);return r&&o?g?((async()=>{let r=await p();if(!r)return W("User must be authenticated and have a Privy wallet before it can be connected");try{await g.connect({accessToken:r,entropyId:T,entropyIdVerifier:_}),P&&await g.verifyMfa({accessToken:r});let o=(Date.now()-S)/1e3;k===y.ModalScreen.EMBEDDED_WALLET_KEY_EXPORT_SCREEN&&o<1?e=setTimeout((()=>{w(k,!1)}),1e3*(1-o)):w(k,!1)}catch(e){if(u.errorIndicatesRecoveryIsNeeded(e)&&"privy"===o.recoveryMethod){let e=await p();if(!e)return W("User must be authenticated and have a Privy wallet before it can be recovered");try{b({eventName:"embedded_wallet_pinless_recovery_started",payload:{walletAddress:o.address}});let r=await(g?.recover({accessToken:e,entropyId:T,entropyIdVerifier:_}));r?.entropyId||W(Error("Unable to recover wallet")),k?w(k):f({shouldCallAuthOnSuccess:!1}),b({eventName:"embedded_wallet_recovery_completed",payload:{walletAddress:o.address}}),w(k)}catch(e){W("An error has occurred, please try again.")}}else u.errorIndicatesRecoveryIsNeeded(e)&&"privy"!==o.recoveryMethod?(I({...x,recoverWallet:{entropyId:T,entropyIdVerifier:_,onCompleteNavigateTo:k,onFailure:E},recoveryOAuthStatus:{provider:o.recoveryMethod,action:"recover",isInAccountCreateFlow:!1}}),w(q.embeddedWalletRecoveryScreen(o.recoveryMethod))):W(e)}})(),()=>clearTimeout(e)):void 0:W("User must be authenticated and have a Privy wallet before it can be connected")}),[r,n,g]);let F=()=>{W("User exited before wallet could be connected"),f({shouldCallAuthOnSuccess:!1})};return C.current=F,/*#__PURE__*/e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(c.ModalHeader,{onClose:F}),A?/*#__PURE__*/e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsxs(s.CenteredItemWithGap,{children:[/*#__PURE__*/e.jsx(m.default,{fill:"var(--privy-color-error)",width:"64px",height:"64px"}),/*#__PURE__*/e.jsx(a.CenteredScreenHeader,{title:"Something went wrong",description:"Weâ€™re on it. Please try again later."})]}),/*#__PURE__*/e.jsx(i.PrimaryButton,{onClick:()=>f({shouldCallAuthOnSuccess:!1}),children:"Close"})]}):/*#__PURE__*/e.jsx(l.FullScreenLoadingSpinner,{}),/*#__PURE__*/e.jsx(v,{})]})};
