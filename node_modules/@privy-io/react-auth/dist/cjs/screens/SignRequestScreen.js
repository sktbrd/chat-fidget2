"use strict";var e=require("react/jsx-runtime"),r=require("@ethersproject/bytes"),i=require("@ethersproject/strings"),o=require("react"),n=require("styled-components"),s=require("@privy-io/js-sdk-core"),t=require("../components/Button.js"),c=require("../components/CopyToClipboard.js"),a=require("../components/Layouts.js"),l=require("../components/ModalFooter.js"),u=require("../components/ModalHeader.js"),d=require("../components/embedded-wallets/StyledLogo.js"),p=require("../components/ui/typography/Subtitle.js"),h=require("../components/ui/typography/Title.js"),j=require("../connectors/errors.js"),g=require("../constants.js"),y=require("../hooks/internal-context.js"),m=require("../hooks/modal-context.js"),q=require("../hooks/privy-context.js"),x=require("../svg/checkmark.js"),f=require("./index.js");require("../components/Loader.js"),require("../svg/copy.js"),require("../svg/protected-by-privy.js"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("../configuration/context.js"),require("../config.js"),require("../configuration/defaultClientConfig.js"),require("../configuration/login-methods.js"),require("../configuration/wallets.js"),require("../connectors/chains/index.js"),require("../connectors/chains/arbitrum.js"),require("../connectors/chains/arbitrumSepolia.js"),require("../connectors/chains/avalanche.js"),require("../connectors/chains/avalancheFuji.js"),require("../connectors/chains/base.js"),require("../connectors/chains/baseSepolia.js"),require("../connectors/chains/berachainArtio.js"),require("../connectors/chains/celo.js"),require("../connectors/chains/celoAlfajores.js"),require("../connectors/chains/filecoin.js"),require("../connectors/chains/filecoinCalibration.js"),require("../connectors/chains/garnetHolesky.js"),require("../connectors/chains/holesky.js"),require("../connectors/chains/linea.js"),require("../connectors/chains/lineaTestnet.js"),require("../connectors/chains/lukso.js"),require("../connectors/chains/mainnet.js"),require("../connectors/chains/optimism.js"),require("../connectors/chains/optimismSepolia.js"),require("../connectors/chains/polygon.js"),require("../connectors/chains/polygonAmoy.js"),require("../connectors/chains/redstone.js"),require("../connectors/chains/sepolia.js"),require("../connectors/chains/zora.js"),require("../connectors/chains/zoraSepolia.js"),require("../connectors/chains/zoraTestnet.js"),require("../connectors/chains/utils.js"),require("../lib/solana/index.js"),require("../theme.js"),require("tinycolor2"),require("../lib/cybr53.js"),require("../hooks/index.js"),require("@ethersproject/logger"),require("../errors.js"),require("ofetch"),require("../components/PrefetchedImage.js");let v=e=>{if(!r.isHexString(e))return e;try{return i.toUtf8String(e)}catch{return e}},S=({data:r})=>{let i=r=>"object"==typeof r&&null!==r?/*#__PURE__*/e.jsx(E,{children:Object.entries(r).map((([r,o])=>/*#__PURE__*/e.jsxs("li",{children:[/*#__PURE__*/e.jsxs("strong",{children:[r,":"]})," ",i(o)]},r)))}):/*#__PURE__*/e.jsx("span",{children:String(r)});/*#__PURE__*/return e.jsx("div",{children:i(r)})},b=r=>{let{types:i,primaryType:o,...n}=r.typedData;/*#__PURE__*/return e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(w,{children:/*#__PURE__*/e.jsx(S,{data:n})}),/*#__PURE__*/e.jsx(c.CopytoClipboardButton,{text:(s=r.typedData,JSON.stringify(s,null,2)),itemName:"full payload to clipboard"})," "]});var s};let w=/*#__PURE__*/n.styled.div.withConfig({displayName:"Message",componentId:"sc-8f49c712-0"})(["margin-top:1.5rem;background-color:var(--privy-color-background-2);border-radius:var(--privy-border-radius-md);padding:12px;text-align:left;max-height:310px;overflow:scroll;white-space:pre-wrap;width:100%;-ms-overflow-style:none;scrollbar-width:none;&::-webkit-scrollbar{display:none;}}"]),E=/*#__PURE__*/n.styled.ul.withConfig({displayName:"MessageList",componentId:"sc-8f49c712-1"})(["margin-left:12px !important;white-space:nowrap;&:first-child{margin-left:0 !important;}strong{font-weight:500 !important;}}"]),C=/*#__PURE__*/n.styled.div.withConfig({displayName:"InputHelp",componentId:"sc-8f49c712-2"})(["line-height:20px;height:20px;font-size:13px;color:",";display:flex;justify-content:flex-start;width:100%;margin-top:16px;margin-bottom:4px;"],(e=>e.$fail?"var(--privy-color-error)":"var(--privy-color-foreground-3)")),R=/*#__PURE__*/n.styled.span.withConfig({displayName:"ContentWithIcon",componentId:"sc-8f49c712-3"})(["display:flex;align-items:center;gap:8px;"]),T=/*#__PURE__*/n.styled.div.withConfig({displayName:"IconContainer",componentId:"sc-8f49c712-4"})(["display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:82px;"]),I=/*#__PURE__*/n.styled.div.withConfig({displayName:"Grow",componentId:"sc-8f49c712-5"})(["flex-grow:1;"]);exports.SignRequestScreen=()=>{let{authenticated:r}=q.usePrivyContext(),{initializeWalletProxy:i,closePrivyModal:n}=y.usePrivyInternal(),{navigate:c,data:S,onUserCloseViaDialogOrKeybindRef:E}=m.usePrivyModal(),[P,k]=o.useState(!0),[_,A]=o.useState(""),[N,L]=o.useState(),[M,U]=o.useState(null),[D,O]=o.useState(!1),F=null!==M;o.useEffect((()=>{r||c(f.ModalScreen.LANDING)}),[r]),o.useEffect((()=>{i(g.WALLET_PROXY_TIMEOUT).then((e=>{k(!1),e||(A("An error has occurred, please try again."),L(new j.PrivyProviderRpcError(new j.ProviderRpcError(_,s.ProviderErrors.E32603_DEFAULT_INTERNAL_ERROR.eipCode))))}))}),[]);let{method:z,data:B,confirmAndSign:H,onSuccess:W,onFailure:G,uiOptions:J}=S.signMessage,Q={title:J.title||"Sign message",description:J.description||"Signing this message will not cost you any fees.",buttonText:J.buttonText||"Sign and continue"},X=e=>{e?W(e):G(N||new j.PrivyProviderRpcError(new j.ProviderRpcError("The user rejected the request.",s.ProviderErrors.E4001_USER_REJECTED_REQUEST.eipCode))),n({shouldCallAuthOnSuccess:!1}),setTimeout((()=>{U(null),A(""),L(void 0)}),200)};return E.current=()=>{X(M)},/*#__PURE__*/e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(u.ModalHeader,{onClose:()=>X(M)}),/*#__PURE__*/e.jsx(a.RefactorSpacerTop,{}),J.iconUrl&&"string"==typeof J.iconUrl?/*#__PURE__*/e.jsx(T,{children:/*#__PURE__*/e.jsx(d.StyledLogo,{size:"sm",src:J.iconUrl,alt:"app image"})}):null,/*#__PURE__*/e.jsx(h.Title,{children:Q.title}),/*#__PURE__*/e.jsx(p.Subtitle,{children:Q.description}),"personal_sign"===z&&/*#__PURE__*/e.jsx(w,{children:v(B)}),"eth_signTypedData_v4"===z&&/*#__PURE__*/e.jsx(b,{typedData:B}),"solana_signMessage"===z&&/*#__PURE__*/e.jsx(w,{children:B}),/*#__PURE__*/e.jsx(I,{}),/*#__PURE__*/e.jsx(C,{$fail:!0,children:_}),/*#__PURE__*/e.jsx(t.PrimaryButtonWithoutGray,{disabled:D||F||P,loading:D,onClick:async()=>{O(!0),A("");try{let e=await H();U(e),O(!1),setTimeout((()=>{X(e)}),g.DEFAULT_SUCCESS_SCREEN_DURATION_MS)}catch(e){console.error(e),A("An error has occurred, please try again."),L(new j.PrivyProviderRpcError(new j.ProviderRpcError(_,s.ProviderErrors.E32603_DEFAULT_INTERNAL_ERROR.eipCode))),O(!1)}},children:D?"Signing...":F?/*#__PURE__*/e.jsxs(R,{children:[/*#__PURE__*/e.jsx(x.Checkmark,{style:{height:"0.9rem",width:"0.9rem"},strokeWidth:2})," ",/*#__PURE__*/e.jsx("span",{children:"Success"})]}):Q.buttonText}),/*#__PURE__*/e.jsx(a.RefactorSpacerBottom,{}),/*#__PURE__*/e.jsx(l.BlobbyFooter,{})]})};
