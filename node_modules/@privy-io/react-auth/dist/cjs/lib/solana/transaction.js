"use strict";var t=require("../../utils/buffer/readBigInt64LE.js");let e=new Intl.NumberFormat(void 0,{style:"currency",currency:"USD",maximumFractionDigits:2});function n(t,e=6,n=!1,r=!1){let o=(parseFloat(t.toString())/1e9).toFixed(e).replace(/0+$/,"").replace(/\.$/,""),a=r?"":" SOL";return n?`${o}${a}`:`${"0"===o?"<0.001":o}${a}`}function r(t,n){let r=parseFloat(t.toString())/1e9,o=e.format(n*r);return"$0.00"===o?"<$0.01":o}function o(t){return"version"in t}function a(t,e,n=0){let r="from"===e?0:"to"===e?1:2;if(o(t)){let e=t.message.getAccountKeys(),o=t.message.compiledInstructions.at(n)?.accountKeyIndexes[r];return o&&e.get(o)||null}let a=t.instructions.at(n)?.keys.at(r)?.pubkey;if(null==a)throw Error(`Transaction does not contain a "${e}" public key`);return a}function s(e,n=!1,r=0){let a=n?1:4;if(o(e)){let n=e.message.compiledInstructions.at(r)?.data;if(!n)return 0n;try{return t.readBigInt64LE(Buffer.from(n),a)}catch(t){return 0n}}let s=e.instructions.at(r)?.data.readBigInt64LE(a);return null==s?0n:s}function i(t,e=0){let n;if(o(t)){let r=t.message.compiledInstructions.at(e)?.programIdIndex;if(null==r)throw Error("Transaction does not contain a Program ID");n=t.message.getAccountKeys().get(r)?.toBase58()}else n=t.instructions.at(e)?.programId.toBase58();if(!n)throw Error("Transaction does not contain a Program ID");return"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"===n?"approve":"11111111111111111111111111111111"===n?"transfer":"instruction"}async function c(t,e){return o(t)?(await e.getFeeForMessage(t.message)).value:await t.getEstimatedFee(e)}exports.LAMPORTS_PER_SOL=1e9,exports.SYSTEM_PROGRAM_ID="11111111111111111111111111111111",exports.TOKEN_PROGRAM_ID="TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",exports.createSolanaTransactionReceipt=function(t,e){return{signature:t,parsedTransaction:e,fees:BigInt(e?.meta?.fee||0)}},exports.decodeSolanaTransaction=async function(t,e){let n=[],r=o(t)?t.message.compiledInstructions.length:t.instructions.length,u={},l=BigInt(await c(t,e)||0);for(let o=0;o<r;o++){let r=i(t,o),c=a(t,"from",o),l=a(t,"to",o),f=s(t,"approve"===r,o),g="transfer"===r?null:a(t,"owner",o),d=0n;c&&(u[c.toBase58()]||(u[c.toBase58()]=BigInt(await e.getBalance(c))),d=u[c.toBase58()]||0n),n.push({from:c,to:l,spender:g,action:r,amount:f,balance:d,hasFunds:d>=f})}return{fees:l,instructions:n}},exports.getDollarsFromLamport=r,exports.getNativeCurrencyFromLamports=n,exports.getSolanaFormattedAmounts=function({amount:t,fee:e,tokenPrice:o}){let a=BigInt(1e9*parseFloat(t)),s=a+e;return{fundingAmountInBaseUnit:a,fundingAmountInUsd:o?r(a,o):void 0,totalPriceInUsd:o?r(s,o):void 0,totalPriceInNativeCurrency:n(s),feePriceInNativeCurrency:n(e),feePriceInUsd:o?r(e,o):void 0}},exports.getTransactionAction=i,exports.getTransactionAddress=a,exports.getTransactionFees=c,exports.getTransactionValue=s,exports.getWalletPublicKeyFromTransaction=function(t,e){if(o(t)){let n=t.message.staticAccountKeys.find((t=>t.toBase58()===e));if(!n)throw Error(`Transaction does not contain public key ${e}`);return n}let n=t.compileMessage().accountKeys.find((t=>t.toBase58()===e));if(!n)throw Error(`Transaction does not contain public key ${e}`);return n},exports.isVersionedTransaction=o;
