"use strict";var r=require("../../auth-flows/cross-app.js"),e=require("../../errors.js"),o=require("../../paths.js"),t=require("../pkce.js");require("ofetch"),require("jose"),require("../../constants.js"),require("../../crypto.js"),require("../../storage.js"),exports.authenticateCrossAppAccount=async function({appId:o,stateCode:t,codeVerifier:i,authorizationCode:a,action:n,client:p}){if(!a||!t)throw new e.PrivyClientError("[Cross-App AuthFlow] Authorization and state codes code must be set prior to calling authenicate.");if("undefined"===a)throw new e.PrivyClientError("User denied confirmation during cross-app auth flow");try{let e=new r.CrossAppAuthFlow({authorizationCode:a,stateCode:t,codeVerifier:i,provider:`privy:${o}`});p.startAuthFlow(e);let s="link"===n?await p.link():await p.authenticate(),d=s.oAuthTokens?.accessToken;return console.debug(),d}catch(o){let r=e.formatApiError(o);if(r.privyErrorCode)throw new e.PrivyClientError(r.message||"Invalid code during cross-app auth flow.",void 0,r.privyErrorCode);if("User denied confirmation during cross-app auth flow"===r.message)throw new e.PrivyClientError("Invalid code during cross-app auth flow.",void 0,e.PrivyErrorCode.OAUTH_USER_DENIED);throw new e.PrivyClientError("Invalid code during cross-app auth flow.",void 0,e.PrivyErrorCode.UNKNOWN_AUTH_ERROR)}},exports.getCrossAppAuthorizationUrl=async function({api:r,appId:i}){let a=t.createCodeVerifier(),n=t.createStateCode(),p=await t.deriveCodeChallengeFromCodeVerifier(a);try{let{url:e}=await r.post(o.oAuthInitPath,{provider:`privy:${i}`,redirect_to:window.location.href,code_challenge:p,state_code:n});return{url:e,stateCode:n,codeVerifier:a}}catch(r){throw e.formatApiError(r)}},exports.getProviderAppMetadata=async function({api:r,requesterAppId:o,providerAppId:t}){let i=(await r.get(`/api/v1/apps/${o}/cross-app/connections`)).connections.find((r=>r.provider_app_id===t));if(!i)throw new e.PrivyClientError("Invalid connected app");return{name:i.provider_app_name,logoUrl:i.provider_app_icon_url||void 0,apiUrl:i.provider_app_custom_api_url,readOnly:i.read_only}};
