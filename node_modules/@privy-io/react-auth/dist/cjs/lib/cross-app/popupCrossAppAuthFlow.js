"use strict";var e=require("./index.js"),t=require("../../errors.js");require("ofetch"),exports.popupCrossAppAuthFlow=async function({url:r,popup:a}){return a.location=r,new Promise(((r,o)=>{let n,i=setTimeout((()=>{o(new t.PrivyClientError("Authorization request timed out after 2 minutes.")),s()}),12e4);function s(){a?.close(),window.removeEventListener("message",d)}let u=setInterval((()=>{a?.closed&&!n&&(s(),clearInterval(u),clearTimeout(i),o(new t.PrivyClientError("User rejected request")))}),300);function d(a){a.data&&("PRIVY_OAUTH_RESPONSE"===a.data.type&&a.data.stateCode&&a.data.authorizationCode&&(clearTimeout(i),r(a.data),s()),"PRIVY_OAUTH_ERROR"===a.data.type&&(clearTimeout(i),o(new t.PrivyClientError(a.data.error)),s()),a.data.type===e.USE_BROADCAST_CHANNEL_EVENT_TYPE&&((n=new BroadcastChannel(e.CROSS_APP_BROADCAST_CHANNEL_NAME)).onmessage=d))}window.addEventListener("message",d)}))};
