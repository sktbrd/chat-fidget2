"use strict";var e=require("../errors.js"),r=require("../hooks/captcha-context.js"),t=require("../paths.js");require("ofetch"),require("react/jsx-runtime"),require("../hooks/index.js"),require("react"),require("../utils/index.js"),require("@ethersproject/providers"),require("../connectors/get-legacy-injected-providers.js"),require("../connectors/is-wallet-installed.js");function a(){let e=new URL(window.location.href);e.searchParams.delete("id"),e.searchParams.delete("hash"),e.searchParams.delete("auth_date"),e.searchParams.delete("first_name"),e.searchParams.delete("last_name"),e.searchParams.delete("username"),e.searchParams.delete("photo_url"),e.hash="",window.history.replaceState({},"",e)}exports.TelegramAuthFlow=class{async authenticate(){if(!this.api)throw new e.PrivyClientError("Auth flow has no API instance");try{return await this.api.post(t.telegramAccountAuthenticatePath,{captcha_token:this.meta.captchaToken,telegram_auth_result:this.meta.telegramAuthResult,telegram_web_app_data:this.meta.telegramWebAppData,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(r){throw e.formatApiError(r)}}async link(){if(!this.api)throw new e.PrivyClientError("Auth flow has no API instance");try{return await this.api.post(t.telegramAccountLinkPath,{telegram_auth_result:this.meta.telegramAuthResult,telegram_web_app_data:this.meta.telegramWebAppData})}catch(r){throw e.formatApiError(r)}}constructor(e,r=!1){this.meta={disableSignup:!1},this.meta={captchaToken:e,disableSignup:!1},this.meta.disableSignup=r}},exports.detectCompletingTelegramFlow=function(){let e;return(e=function(){let e=new URLSearchParams(window.location.search),r=Number(e.get("id")||""),t=e.get("hash"),a=Number(e.get("auth_date")||""),i=e.get("first_name");if(r&&i&&a&&t)return Object.fromEntries(e.entries())}())?(a(),{flowType:"login-url",authData:e}):(e=function(){let e=window.location.hash;if(!e||!e.startsWith("#tgWebAppData"))return;let r=new URLSearchParams(decodeURIComponent(e.replace("#tgWebAppData=",""))),t=r.get("user"),a=Number(r.get("auth_date")||""),i=r.get("hash");return t&&a&&i?Object.fromEntries(r.entries()):void 0}())?(a(),{flowType:"web-app",authData:e}):void 0},exports.getTelegramAuthErrorMessage=function(t){let a={detail:"",retryable:!1};return t?.privyErrorCode===e.PrivyErrorCode.LINKED_TO_ANOTHER_USER&&(a.detail="This account has already been linked to another user."),t?.privyErrorCode===e.PrivyErrorCode.DISALLOWED_LOGIN_METHOD&&(a.detail="Login with Telegram not allowed."),t?.privyErrorCode===e.PrivyErrorCode.INVALID_DATA&&(a.retryable=!0,a.detail="Something went wrong. Try again."),t?.privyErrorCode===e.PrivyErrorCode.CANNOT_LINK_MORE_OF_TYPE&&(a.retryable=!0,a.detail="Something went wrong. Try again."),t?.privyErrorCode===e.PrivyErrorCode.INVALID_CREDENTIALS&&(a.retryable=!0,a.detail="Something went wrong. Try again."),t?.privyErrorCode===e.PrivyErrorCode.TOO_MANY_REQUESTS&&(a.detail="Too many requests. Please wait before trying again."),t?.privyErrorCode===e.PrivyErrorCode.TOO_MANY_REQUESTS&&t.message.includes("rate limit")&&(a.detail="Request limit reached for Telegram. Please wait a moment and try again."),t instanceof r.CaptchaError&&(a.retryable=!0,a.detail="Something went wrong. Try again."),a};
