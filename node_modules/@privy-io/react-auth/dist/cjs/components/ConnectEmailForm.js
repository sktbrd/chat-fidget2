"use strict";var e=require("react/jsx-runtime"),r=require("@heroicons/react/24/outline/EnvelopeIcon"),i=require("react"),n=require("../configuration/context.js"),o=require("../errors.js"),s=require("../hooks/captcha-context.js"),t=require("../hooks/internal-context.js"),a=require("../hooks/modal-context.js"),c=require("../hooks/privy-context.js"),u=require("../recent-login/context.js"),l=require("../screens/index.js"),j=require("../utils/index.js"),d=require("./Button.js"),h=require("./ui/chips/Chip.js"),q=require("./ui/forms/EmailInputForm.js"),m=require("./ui/typography/ErrorMessage.js");function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("../config.js"),require("../configuration/defaultClientConfig.js"),require("../constants.js"),require("../configuration/login-methods.js"),require("../configuration/wallets.js"),require("../connectors/chains/index.js"),require("../connectors/chains/arbitrum.js"),require("../connectors/chains/arbitrumSepolia.js"),require("../connectors/chains/avalanche.js"),require("../connectors/chains/avalancheFuji.js"),require("../connectors/chains/base.js"),require("../connectors/chains/baseSepolia.js"),require("../connectors/chains/berachainArtio.js"),require("../connectors/chains/celo.js"),require("../connectors/chains/celoAlfajores.js"),require("../connectors/chains/filecoin.js"),require("../connectors/chains/filecoinCalibration.js"),require("../connectors/chains/garnetHolesky.js"),require("../connectors/chains/holesky.js"),require("../connectors/chains/linea.js"),require("../connectors/chains/lineaTestnet.js"),require("../connectors/chains/lukso.js"),require("../connectors/chains/mainnet.js"),require("../connectors/chains/optimism.js"),require("../connectors/chains/optimismSepolia.js"),require("../connectors/chains/polygon.js"),require("../connectors/chains/polygonAmoy.js"),require("../connectors/chains/redstone.js"),require("../connectors/chains/sepolia.js"),require("../connectors/chains/zora.js"),require("../connectors/chains/zoraSepolia.js"),require("../connectors/chains/zoraTestnet.js"),require("../connectors/chains/utils.js"),require("../lib/solana/index.js"),require("../theme.js"),require("tinycolor2"),require("../lib/cybr53.js"),require("ofetch"),require("../hooks/index.js"),require("@ethersproject/providers"),require("../connectors/get-legacy-injected-providers.js"),require("../connectors/is-wallet-installed.js"),require("./PrefetchedImage.js"),require("../hooks/events-context.js"),require("../storage.js"),require("styled-components"),require("./Loader.js"),require("./ui/animation/LoadingSkeleton.js");var g=/*#__PURE__*/p(r);const S=/*#__PURE__*/i.forwardRef(((r,q)=>{let[p,S]=i.useState(r.defaultValue||""),[f,v]=i.useState(""),[x,b]=i.useState(!1),{authenticated:C}=c.usePrivyContext(),{initLoginWithEmail:k}=t.usePrivyInternal(),{navigate:A,setModalData:P,currentScreen:R,data:I}=a.usePrivyModal(),{enabled:M,token:T}=s.useCaptcha(),[L,D]=i.useState(!1),{accountType:N}=u.useRecentlyUsedLogin(),_=n.useAppConfig();i.useEffect((()=>{!p&&_.disablePlusEmails&&I?.inlineError?.error instanceof o.PrivyError&&I?.inlineError?.error.privyErrorCode===o.PrivyErrorCode.DISALLOWED_PLUS_EMAIL&&!f&&v("Please enter a valid email address without a '+'."),f&&v("")}),[p]);let F=j.validateEmail(p),O=x||!F,w=()=>{var e;P({inlineError:void 0}),!M||T||C?(e=T,b(!0),k({email:p,captchaToken:e,disableSignup:I?.login?.disableSignup,withPrivyUi:!0}).then((()=>{A(l.ModalScreen.AWAITING_PASSWORDLESS_CODE)})).catch((e=>{P({errorModalData:{error:e,previousScreen:R||l.ModalScreen.LANDING}}),A(l.ModalScreen.ERROR_SCREEN)})).finally((()=>{b(!1)}))):(P({captchaModalData:{callback:e=>k({email:p,captchaToken:e,withPrivyUi:!0}),userIntentRequired:!1,onSuccessNavigateTo:l.ModalScreen.AWAITING_PASSWORDLESS_CODE,onErrorNavigateTo:l.ModalScreen.ERROR_SCREEN}}),A(l.ModalScreen.CAPTCHA_SCREEN))};/*#__PURE__*/return e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsxs(E,{children:[f&&/*#__PURE__*/e.jsx(m.ErrorMessage,{style:{display:"block",marginTop:"0.25rem",textAlign:"left"},children:f}),/*#__PURE__*/e.jsxs(y,{stacked:r.stacked,$error:!!f,children:[/*#__PURE__*/e.jsx(g.default,{}),/*#__PURE__*/e.jsx("input",{ref:q,id:"email-input",className:"login-method-button",type:"email",placeholder:"your@email.com",onFocus:()=>D(!0),onChange:e=>S(e.target.value),onKeyUp:e=>{"Enter"===e.key&&w()},value:p,autoComplete:"email"}),"email"!==N||L?r.stacked?/*#__PURE__*/e.jsx("span",{}):/*#__PURE__*/e.jsx(d.EmbeddedButton,{isSubmitting:x,onClick:w,disabled:O,children:"Submit"}):/*#__PURE__*/e.jsx(h.Chip,{color:"gray",children:"Recent"})]})]}),r.stacked?/*#__PURE__*/e.jsx(d.PrimaryButton,{loadingText:null,loading:x,disabled:O,onClick:w,children:"Submit"}):null]})}));let E=q.InputContainerForm,y=q.EmailInputForm;exports.ConnectEmailForm=S;
